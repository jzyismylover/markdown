<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker | Mr.Jiang-技术博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?2675818a983a3131404cee835018f016";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script>
    <meta name="description" content="学习&amp;工作-技术积累">
    
    <link rel="preload" href="/markdown/assets/css/0.styles.5474aed4.css" as="style"><link rel="preload" href="/markdown/assets/js/app.085aa012.js" as="script"><link rel="preload" href="/markdown/assets/js/2.773263cd.js" as="script"><link rel="preload" href="/markdown/assets/js/36.c13df5f5.js" as="script"><link rel="prefetch" href="/markdown/assets/js/1.50bc9635.js"><link rel="prefetch" href="/markdown/assets/js/10.121e7e8f.js"><link rel="prefetch" href="/markdown/assets/js/11.5205ffab.js"><link rel="prefetch" href="/markdown/assets/js/12.fef29d74.js"><link rel="prefetch" href="/markdown/assets/js/13.b581db50.js"><link rel="prefetch" href="/markdown/assets/js/14.07202c28.js"><link rel="prefetch" href="/markdown/assets/js/15.9aedb95a.js"><link rel="prefetch" href="/markdown/assets/js/16.dd97e264.js"><link rel="prefetch" href="/markdown/assets/js/17.8eb943fb.js"><link rel="prefetch" href="/markdown/assets/js/18.942cde78.js"><link rel="prefetch" href="/markdown/assets/js/19.44710683.js"><link rel="prefetch" href="/markdown/assets/js/20.22d46747.js"><link rel="prefetch" href="/markdown/assets/js/21.aa8b4011.js"><link rel="prefetch" href="/markdown/assets/js/22.b40024cc.js"><link rel="prefetch" href="/markdown/assets/js/23.ace5d346.js"><link rel="prefetch" href="/markdown/assets/js/24.2405d60a.js"><link rel="prefetch" href="/markdown/assets/js/25.c08a85e2.js"><link rel="prefetch" href="/markdown/assets/js/26.c4c5f267.js"><link rel="prefetch" href="/markdown/assets/js/27.b91e5849.js"><link rel="prefetch" href="/markdown/assets/js/28.b80c3633.js"><link rel="prefetch" href="/markdown/assets/js/29.594ec447.js"><link rel="prefetch" href="/markdown/assets/js/3.9d4223ad.js"><link rel="prefetch" href="/markdown/assets/js/30.324e278d.js"><link rel="prefetch" href="/markdown/assets/js/31.43dc2191.js"><link rel="prefetch" href="/markdown/assets/js/32.3fb01abd.js"><link rel="prefetch" href="/markdown/assets/js/33.5a2693b9.js"><link rel="prefetch" href="/markdown/assets/js/34.637d4661.js"><link rel="prefetch" href="/markdown/assets/js/35.eccfebaa.js"><link rel="prefetch" href="/markdown/assets/js/37.9890e89c.js"><link rel="prefetch" href="/markdown/assets/js/38.b33827f2.js"><link rel="prefetch" href="/markdown/assets/js/39.3a1ace37.js"><link rel="prefetch" href="/markdown/assets/js/4.27d6f5b1.js"><link rel="prefetch" href="/markdown/assets/js/40.4396d4c2.js"><link rel="prefetch" href="/markdown/assets/js/41.afe775e0.js"><link rel="prefetch" href="/markdown/assets/js/42.19b2951c.js"><link rel="prefetch" href="/markdown/assets/js/43.7c3256ea.js"><link rel="prefetch" href="/markdown/assets/js/44.7da308e4.js"><link rel="prefetch" href="/markdown/assets/js/45.89b2fd21.js"><link rel="prefetch" href="/markdown/assets/js/46.e817e45d.js"><link rel="prefetch" href="/markdown/assets/js/47.c56ee626.js"><link rel="prefetch" href="/markdown/assets/js/48.59541039.js"><link rel="prefetch" href="/markdown/assets/js/49.bc7ad96a.js"><link rel="prefetch" href="/markdown/assets/js/5.2637f2cc.js"><link rel="prefetch" href="/markdown/assets/js/50.9d0dc446.js"><link rel="prefetch" href="/markdown/assets/js/51.4d949834.js"><link rel="prefetch" href="/markdown/assets/js/52.90aa4f80.js"><link rel="prefetch" href="/markdown/assets/js/53.67b77129.js"><link rel="prefetch" href="/markdown/assets/js/54.3535db37.js"><link rel="prefetch" href="/markdown/assets/js/55.9efbe9e5.js"><link rel="prefetch" href="/markdown/assets/js/56.e8aa37ba.js"><link rel="prefetch" href="/markdown/assets/js/57.af66ff8f.js"><link rel="prefetch" href="/markdown/assets/js/58.0415674f.js"><link rel="prefetch" href="/markdown/assets/js/59.b09373ca.js"><link rel="prefetch" href="/markdown/assets/js/6.61bacfb8.js"><link rel="prefetch" href="/markdown/assets/js/60.d07cb515.js"><link rel="prefetch" href="/markdown/assets/js/61.ec2b2da7.js"><link rel="prefetch" href="/markdown/assets/js/62.44a5a0b8.js"><link rel="prefetch" href="/markdown/assets/js/63.09e39adc.js"><link rel="prefetch" href="/markdown/assets/js/64.b9ee085d.js"><link rel="prefetch" href="/markdown/assets/js/65.026450b0.js"><link rel="prefetch" href="/markdown/assets/js/66.a3571972.js"><link rel="prefetch" href="/markdown/assets/js/67.5a8616c4.js"><link rel="prefetch" href="/markdown/assets/js/68.6fdda787.js"><link rel="prefetch" href="/markdown/assets/js/69.691ff5d7.js"><link rel="prefetch" href="/markdown/assets/js/7.32a4bd87.js"><link rel="prefetch" href="/markdown/assets/js/70.b401009e.js"><link rel="prefetch" href="/markdown/assets/js/71.6b3bcefe.js"><link rel="prefetch" href="/markdown/assets/js/72.dcd8145e.js"><link rel="prefetch" href="/markdown/assets/js/73.cc81c046.js"><link rel="prefetch" href="/markdown/assets/js/74.856f40f0.js"><link rel="prefetch" href="/markdown/assets/js/75.746590de.js"><link rel="prefetch" href="/markdown/assets/js/76.8ddba5b5.js"><link rel="prefetch" href="/markdown/assets/js/77.16644476.js"><link rel="prefetch" href="/markdown/assets/js/78.e89fc885.js"><link rel="prefetch" href="/markdown/assets/js/79.1193b665.js"><link rel="prefetch" href="/markdown/assets/js/80.9475cd89.js"><link rel="prefetch" href="/markdown/assets/js/81.8d99d275.js"><link rel="prefetch" href="/markdown/assets/js/82.80eb3e2f.js"><link rel="prefetch" href="/markdown/assets/js/83.fe14141e.js"><link rel="prefetch" href="/markdown/assets/js/84.9647a2db.js"><link rel="prefetch" href="/markdown/assets/js/85.c7258f01.js"><link rel="prefetch" href="/markdown/assets/js/86.1a5782f4.js"><link rel="prefetch" href="/markdown/assets/js/87.e7354607.js"><link rel="prefetch" href="/markdown/assets/js/vendors~docsearch.54f2532f.js">
    <link rel="stylesheet" href="/markdown/assets/css/0.styles.5474aed4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown/" class="home-link router-link-active"><img src="/markdown/logo.png" alt="Mr.Jiang-技术博客" class="logo"> <span class="site-name can-hide">Mr.Jiang-技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/markdown/docker/#背景" class="sidebar-link">背景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/docker/#场景一-单机" class="sidebar-link">场景一：单机</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#场景二-多机" class="sidebar-link">场景二：多机</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#容器技术-vs-虚拟机技术" class="sidebar-link">容器技术 VS 虚拟机技术</a></li></ul></li><li><a href="/markdown/docker/#基础命令" class="sidebar-link">基础命令</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#联合文件系统" class="sidebar-link">联合文件系统</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#提交新镜像" class="sidebar-link">提交新镜像</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#容器与宿主机通信" class="sidebar-link">容器与宿主机通信</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#容器数据卷" class="sidebar-link">容器数据卷</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#部件安装" class="sidebar-link">部件安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/docker/#安装-mysql" class="sidebar-link">安装 mysql</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#安装-gitlab" class="sidebar-link">安装 gitlab</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#安装-gitlab-runner" class="sidebar-link">安装 gitlab-runner</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#安装-jenkins" class="sidebar-link">安装 jenkins</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#安装-redis" class="sidebar-link">安装 redis</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#安装-registry" class="sidebar-link">安装 registry</a></li></ul></li><li><a href="/markdown/docker/#docker-进阶" class="sidebar-link">docker 进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/docker/#容器状态" class="sidebar-link">容器状态</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#网络" class="sidebar-link">网络</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#自定义网络" class="sidebar-link">自定义网络</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#dockerfile" class="sidebar-link">Dockerfile</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#from" class="sidebar-link" style="padding-left:3rem;">FROM</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#maintainer" class="sidebar-link" style="padding-left:3rem;">MAINTAINER</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#run" class="sidebar-link" style="padding-left:3rem;">RUN</a></li></ul></li><li><a href="/markdown/docker/#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#基础配置" class="sidebar-link">基础配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/docker/#network" class="sidebar-link">network</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#volumes" class="sidebar-link">volumes</a></li><li class="sidebar-sub-header"><a href="/markdown/docker/#应用启动" class="sidebar-link">应用启动</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content"><div class="content-wrapper" style="width:100%"><div class="theme-default-content custom-content content__default"><h1 id="docker"><a href="#docker" class="header-anchor">#</a> docker</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>docker 的出现使得环境可以跨平台，不依赖与主机的操作系统。</p> <p><a href="https://baike.baidu.com/item/Docker/13344470" target="_blank" rel="noopener noreferrer">docker 百度百科<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="场景一-单机"><a href="#场景一-单机" class="header-anchor">#</a> 场景一：单机</h3> <img src="/markdown/assets/img/image.9b80205e.png" style="display:block;margin:auto;"> <p>在同一台电脑安装不同环境的项目</p> <h3 id="场景二-多机"><a href="#场景二-多机" class="header-anchor">#</a> 场景二：多机</h3> <img src="/markdown/assets/img/image-1.3a4b915c.png" style="display:block;margin:auto;"> <p>在不同操作系统的电脑下载不同环境的项目</p> <ul><li>docker 的出现解决的问题：镜像机制，通过将环境也打包进入镜像仓库，别人从仓库拉下来的时候连同项目代码和环境也拉下来，然后直接运行就可以啦！！！</li> <li>docker 的核心思想是隔离，每个集装箱是互相隔离的，互不影响，这就能解决之前多项目端口冲突的问题。</li></ul> <h3 id="容器技术-vs-虚拟机技术"><a href="#容器技术-vs-虚拟机技术" class="header-anchor">#</a> 容器技术 VS 虚拟机技术</h3> <p>虚拟机</p> <ul><li>笨重，资源占用多，冗余步骤多，启动慢(相当于一台独立的主机)</li></ul> <p>容器</p> <ul><li><p>容器化技术不是模拟一个完整的操作系统，容器与容器之间互相隔离</p></li> <li><p>镜像文件非常小巧(只包括一些非常常用的启动脚本和命令)</p></li></ul> <h2 id="基础命令"><a href="#基础命令" class="header-anchor">#</a> 基础命令</h2> <ul><li>删除所有的镜像文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> $ <span class="token function">docker</span> image <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> image <span class="token function">ls</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
 $ <span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> image <span class="token function">ls</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>删除容器</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 利用可变参数</span>
$ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-aq</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">docker</span> stop
$ <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">docker</span> <span class="token function">rm</span>

$ <span class="token function">docker</span> stop <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
$ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>容器重命名</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token function">rename</span> <span class="token punctuation">[</span>原容器名<span class="token punctuation">]</span> <span class="token punctuation">[</span>现容器名<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>进入容器</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token number">6527</span> /bin/bash
<span class="token comment"># 假如出现报错的话启用下面这种</span>
$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token number">6527</span> /bin/sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> attach <span class="token operator">&lt;</span>container_id<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>attach 直接进入容器启动命令的终端不会启动新的进程，用 exit 退出会导致容器的停止</li> <li>exec 是在容器中打开新的终端，并且可以启动新的进程，用 exit 退出不会导致容器的停止</li></ul> <ul><li>容器退出删除命令</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">exit</span> <span class="token comment">#容器退出</span>
Ctrl+P+Q <span class="token comment">#不停止推出</span>

<span class="token function">docker</span> <span class="token function">rm</span> 容器id                  <span class="token comment"># 删除指定的容器 不能删除正在运行的</span>
<span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-aq</span><span class="token variable">)</span></span>     <span class="token comment"># 删除所有容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">docker</span> <span class="token function">rm</span> <span class="token comment"># 删除所有容器</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>启动、停止容器命令</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 启动容器</span>
<span class="token function">docker</span> start 容器id
<span class="token comment"># 重启容器</span>
<span class="token function">docker</span> restart 容器id
<span class="token comment"># 停止容器运行</span>
<span class="token function">docker</span> stop 容器id
<span class="token comment"># 杀死容器</span>
<span class="token function">docker</span> <span class="token function">kill</span> 容器id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 以交互式 shell 执行我们启动的容器</span>
$ <span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">80</span>:8080/tcp ubuntu <span class="token function">bash</span>
$ <span class="token function">docker</span> run <span class="token parameter variable">-it</span> nginx:latest /bin/bash

$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> mynginx <span class="token parameter variable">-d</span> nginx:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>docker 进入容器终端的两种退出方式</p> <ul><li>exit(终止当前容器运行)</li> <li>ctrl + p + q (不终止当前容器运行)</li></ul></li> <li><p>docker 查看内部容器的运行进程情况</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token function">top</span> <span class="token operator">&lt;</span>container_id<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>容器数据拷贝</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token function">cp</span> <span class="token operator">&lt;</span>container_id<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>容器内路径<span class="token operator">&gt;</span> 目的主机路径
$ <span class="token function">docker</span> <span class="token function">cp</span> ddb1:/usr/share/nginx/html /var
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>容器镜像备份
<ul><li>export 导出容器的内容作为一个 tar 归档文件</li> <li>import 从 tar 包中的内容创建一个新的文件系统再导入镜像</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="联合文件系统"><a href="#联合文件系统" class="header-anchor">#</a> 联合文件系统</h2> <p>union 文件系统是一种分层、轻量级并且高性能的文件系统。</p> <h2 id="提交新镜像"><a href="#提交新镜像" class="header-anchor">#</a> 提交新镜像</h2> <p>提交容器副本使之成为一个新的镜像</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> commit <span class="token parameter variable">-m</span> <span class="token string">&quot;提交描述信息&quot;</span> <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">&quot;作者&quot;</span> 容器id 要创建的目标镜像名:<span class="token punctuation">[</span>标签名<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>jzy:/var/ $ <span class="token function">docker</span> commit <span class="token parameter variable">-m</span><span class="token operator">=</span><span class="token string">&quot;install vim in ubuntu&quot;</span> <span class="token parameter variable">-a</span><span class="token operator">=</span><span class="token string">'jzyismylover'</span> 1f4ba0556d96 jubuntu:1.0     <span class="token punctuation">[</span><span class="token number">0</span>:32:34<span class="token punctuation">]</span>
sha256:8a29d66dfb70ed231b380d9e2b2615f15718ea5a53dc85c272f9b545abcdffc3
jzy:/var/ $ <span class="token function">docker</span> images                                                                           <span class="token punctuation">[</span><span class="token number">0</span>:33:39<span class="token punctuation">]</span>
REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
jubuntu       <span class="token number">1.0</span>       8a29d66dfb70   <span class="token number">11</span> seconds ago   180MB
qingyu-docs   latest    53dcfcf198fe   <span class="token number">9</span> hours ago      <span class="token number">24</span>.3MB
ubuntu        latest    ba6acccedd29   <span class="token number">13</span> months ago    <span class="token number">72</span>.8MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="容器与宿主机通信"><a href="#容器与宿主机通信" class="header-anchor">#</a> 容器与宿主机通信</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 将容器上的文件拷贝到当前宿主机的文件夹</span>
$ <span class="token function">docker</span> <span class="token function">cp</span> mycontainer:/opt/testnew/file.txt /opt/test/

<span class="token comment"># 将宿主机的文件拷贝到容器上的文件夹</span>
$ <span class="token function">docker</span> <span class="token function">cp</span> /opt/test/ mycontainer:/opt/testnew/file.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="容器数据卷"><a href="#容器数据卷" class="header-anchor">#</a> 容器数据卷</h2> <p>容器内文件和宿主机文件的共享同步，容器数据卷的方式完成数据的<strong>持久化</strong>，把容器内的数据备份 + 持久化到本机宿主机目录，保证容器内的数据不会消失。</p> <p>代码：<code>docker run -privileged=true -v 宿主机目录:容器目录 镜像</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token parameter variable">-v</span> /var/registry:/tmp/registry <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> ubuntu-testing <span class="token parameter variable">-v</span> /tmp/dockerData:/var/docker ubuntu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>无论容器是否停止下次启动的时候 docker 依然会和数据卷的数据进行同步。了解了持久化的概念后其实开启容器卷也有分相关权限的，读权限、写权限（只对容器内进行限制）</p> <ul><li>可读可写 rw</li> <li>只可读 ro</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> ubuntu-testing <span class="token parameter variable">-v</span> /tmp/dockerData:/var/docker:ro ubuntu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>容器数据卷的继承和共享。<code>docker run --volumes-from 继承的容器</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> ubuntu-02 --volumes-from ubuntu-01 ubuntu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="部件安装"><a href="#部件安装" class="header-anchor">#</a> 部件安装</h2> <h3 id="安装-mysql"><a href="#安装-mysql" class="header-anchor">#</a> 安装 mysql</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> pull mysql:latest

$ 	<span class="token function">docker</span> run <span class="token parameter variable">--detach</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--publish</span> <span class="token number">5006</span>:3306 <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">--volume</span> /docker/mysql/log:/var/log/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">--volume</span> /docker/mysql/data:/var/lib/mysql <span class="token punctuation">\</span>
<span class="token parameter variable">--volume</span> /docker/mysql/conf:/etc/mysql/conf.d <span class="token punctuation">\</span>
<span class="token parameter variable">--env</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>jzy <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> mysql <span class="token punctuation">\</span>
mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>修改 mysql 配置解决中文乱码问题，在 conf.d / conf 里面新建一个 my.cnf</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>☁  conf  <span class="token function">cat</span> my.cnf
<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
default-character-set <span class="token operator">=</span> utf8

<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
character-set-server <span class="token operator">=</span> utf8
collation-server <span class="token operator">=</span> utf8_general_ci
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code> Variable_name            <span class="token operator">|</span> Value                          <span class="token operator">|</span>
+--------------------------+--------------------------------+
<span class="token operator">|</span> character_set_client     <span class="token operator">|</span> utf8mb3                        <span class="token operator">|</span>
<span class="token operator">|</span> character_set_connection <span class="token operator">|</span> utf8mb3                        <span class="token operator">|</span>
<span class="token operator">|</span> character_set_database   <span class="token operator">|</span> utf8mb3                        <span class="token operator">|</span>
<span class="token operator">|</span> character_set_filesystem <span class="token operator">|</span> binary                         <span class="token operator">|</span>
<span class="token operator">|</span> character_set_results    <span class="token operator">|</span> utf8mb3                        <span class="token operator">|</span>
<span class="token operator">|</span> character_set_server     <span class="token operator">|</span> utf8mb3                        <span class="token operator">|</span>
<span class="token operator">|</span> character_set_system     <span class="token operator">|</span> utf8mb3                        <span class="token operator">|</span>
<span class="token operator">|</span> character_sets_dir       <span class="token operator">|</span> /usr/share/mysql-8.0/charsets/ <span class="token operator">|</span>
+--------------------------+-------------------------------
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="安装-gitlab"><a href="#安装-gitlab" class="header-anchor">#</a> <a href="https://zhuanlan.zhihu.com/p/413217715" target="_blank" rel="noopener noreferrer">安装 gitlab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> pull gitlab/gitlab-ci
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>不知道为啥 docker hub 上搜不到这个镜像的相关信息，但是很多教程都是基于这个镜像来安装 gitlab，那就按照教程来吧。下载的过程非常漫长，估计是因为源在外国的原因，因此考虑更换为阿里云加速镜像源。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;https://6ztirue0.mirror.aliyuncs.com&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看日志</span>
$ <span class="token function">dmesg</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>启动 gitlab 镜像</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> /docker
$ <span class="token builtin class-name">cd</span> /docker
$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span>
<span class="token number">6443</span>:443 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">6022</span>:22 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">6080</span>: <span class="token number">80</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /docker/gitlab/etc:/etc/gitlab <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /docker/gitlab/log:/var/log/gitlab <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /docker/gitlab/opt:/var/opt/gitlab <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true  <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> gitlab <span class="token punctuation">\</span>
gitlab/gitlab-ce
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>启动了容器以后在端口存在内外映射不一致的基础上，进入容器内部进行配置修改</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> gitlab /bin/bash

<span class="token comment"># 修改 gitlab.rb 配置文件</span>
$ <span class="token function">vi</span> /etc/gitlab/gitlab.rb
<span class="token comment">## 加入如下</span>
<span class="token comment"># gitlab访问地址，可以写域名。如果端口不写的话默认为80端口</span>
external_url <span class="token string">'http://101.133.225.166'</span>
<span class="token comment"># ssh主机ip</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_ssh_host'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'101.133.225.166'</span>
<span class="token comment"># ssh连接端口</span>
gitlab_rails<span class="token punctuation">[</span><span class="token string">'gitlab_shell_ssh_port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">9922</span>

$ gitlab-ctl reconfigure
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>然后更新完配置以后需要解决映射的问题了，<code>/etc/gitlab/gitlab.rb</code> 文件的配置会映射到 <code>gitlab.yml</code> 这个文件，由于在 docker 中运行，在 gitlab 上生成的 http 地址应该是 <code>http://localhost:6088</code>,所以，要修改下面文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">vi</span> /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml

  gitlab:
    host: <span class="token number">101.133</span>.225.166
    port: <span class="token number">6080</span> <span class="token comment"># 这里改为6080</span>
    https: <span class="token boolean">false</span>

$ gitlab-ctl restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>大致上其实配置上述就可完成 gitlab 的访问了（可能会出现 502，但其实我猜测是因为延时设得太短的问题）。然后就是登录的问题了，其实我们并不知道我们的用户名和密码是啥，用户名可以查下是 root，密码可用下面命令行获得：</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ /etc/gitlab/initial_root_password
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Administrator&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;active&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;avatar_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&amp;d=identicon&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;web_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://127.0.0.1:6080/root&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="安装-gitlab-runner"><a href="#安装-gitlab-runner" class="header-anchor">#</a> 安装 gitlab-runner</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /docker/gitlab-runner/config:/etc/gitlab-runner <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> gitlab-runner <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true  <span class="token punctuation">\</span>
gitlab/gitlab-runner:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="安装-jenkins"><a href="#安装-jenkins" class="header-anchor">#</a> <a href="https://www.cnblogs.com/esofar/p/11163583.html" target="_blank" rel="noopener noreferrer">安装 jenkins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>tips: 要更换阿里云加速镜像不然下不来</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">vim</span> /etc/docker/daemon.json
<span class="token punctuation">{</span>
<span class="token string">&quot;registry-mirrors&quot;</span>:<span class="token punctuation">[</span>
  <span class="token string">&quot;https://hub-mirror.c.163.com&quot;</span>,
  <span class="token string">&quot;https://registry.aliyuncs.com&quot;</span>,
  <span class="token string">&quot;https://registry.docker-cn.com&quot;</span>,
  <span class="token string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
$ systemctl restart <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> search jenkins
$ <span class="token function">docker</span> pull jenkins/jenkins:latest
$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">5000</span>:8080 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /docker/jenkins/:/var/jenkins_home <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> jenkins <span class="token punctuation">\</span>
jenkins/jenkins

<span class="token comment"># 推荐使用这个镜像构建</span>
$ <span class="token function">docker</span> pull jenkinsci/blueocean
$ <span class="token function">docker</span> run <span class="token parameter variable">-u</span> root <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">5000</span>:8080 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">50000</span>:50000 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /docker/jenkins:/var/jenkins_home <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> jenkins <span class="token punctuation">\</span>
jenkinsci/blueocean
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>遇到的 bugs:</p> <ol><li>修改/var/lib/jenkins/updates/default.json</li></ol> <p>jenkins 在下载插件之前会先检查网络连接，其会读取这个文件中的网址。默认是：访问谷歌，这就很坑了，服务器网络又不能 FQ，所以将图下的 google 改为 <code>www.baidu.com</code>即可，更改完重启服务。</p> <img src="https://images2018.cnblogs.com/blog/1235834/201807/1235834-20180723182817537-757932915.png" style="display:block;margin:auto;"> <ol start="2"><li>修改/var/lib/jenkins/hudson.model.UpdateCenter.xml</li></ol> <p>该文件为 jenkins 下载插件的源地址，改地址默认 jenkins 默认为：<code>https://updates.jenkins.io/update-center.json</code>，就是因为 https 的问题，此处我们将其改为 http 即可，之后重启 jenkins 服务即可。其他国内备用地址（也可以选择使用）：</p> <p><code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p> <p><code>http://mirror.esuni.jp/jenkins/updates/update-center.json</code></p> <h3 id="安装-redis"><a href="#安装-redis" class="header-anchor">#</a> 安装 redis</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> pull redis

<span class="token comment"># 安装 redis 配置文件(默认docker容器不会创建这个)</span>
$ <span class="token function">wget</span> http://download.redis.io/redis-stable/redis.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>修改配置文件</code></p> <ul><li>bind 127.0.0.1 -::1 #这行要注释掉，解除<a href="https://www.zhihu.com/search?q=%E6%9C%AC%E5%9C%B0%E8%BF%9E%E6%8E%A5&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2672255852%7D" target="_blank" rel="noopener noreferrer">本地连接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>限制</li> <li>protected-mode no #默认 yes，如果设置为 yes，则只允许在本机的回环连接，其他机器无法连接。</li> <li>daemonize no #默认 no 为不<a href="https://www.zhihu.com/search?q=%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2672255852%7D" target="_blank" rel="noopener noreferrer">守护进程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>模式，docker 部署不需要改为 yes，docker run -d 本身就是后台启动，不然会冲突</li> <li>requirepass 123456 #设置密码</li> <li>appendonly yes #持久化</li></ul> <p><code>运行容器</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> redis <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">6379</span>:6379 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /var/redis/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /var/redis/data:/data <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> redis redis-server /etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token parameter variable">--appendonly</span> <span class="token function">yes</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--requirepass</span> jzy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看 redis 容器启动日志</span>
☁  redis  <span class="token function">docker</span> logs <span class="token parameter variable">--since</span> 30m redis
<span class="token number">1</span>:C 04 Feb <span class="token number">2023</span> 02:25:47.418 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">1</span>:C 04 Feb <span class="token number">2023</span> 02:25:47.419 <span class="token comment"># Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started</span>
<span class="token number">1</span>:C 04 Feb <span class="token number">2023</span> 02:25:47.419 <span class="token comment"># Configuration loaded</span>
<span class="token number">1</span>:M 04 Feb <span class="token number">2023</span> 02:25:47.420 * monotonic clock: POSIX clock_gettime
<span class="token number">1</span>:M 04 Feb <span class="token number">2023</span> 02:25:47.420 <span class="token comment"># Warning: Could not create server TCP listening socket ::1:6379: bind: Cannot assign requested address</span>
<span class="token number">1</span>:M 04 Feb <span class="token number">2023</span> 02:25:47.421 * Running <span class="token assign-left variable">mode</span><span class="token operator">=</span>standalone, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>.
<span class="token number">1</span>:M 04 Feb <span class="token number">2023</span> 02:25:47.421 <span class="token comment"># Server initialized</span>
<span class="token number">1</span>:M 04 Feb <span class="token number">2023</span> 02:25:47.421 <span class="token comment"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</span>
<span class="token number">1</span>:M 04 Feb <span class="token number">2023</span> 02:25:47.422 * Ready to accept connections
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>进入 redis 容器</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> redis redis-cli
$ auth <span class="token punctuation">[</span>password<span class="token punctuation">]</span>
$ <span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="安装-registry"><a href="#安装-registry" class="header-anchor">#</a> 安装 registry</h3> <p>Docker 官方的 Docker Registry 是一个基础版本的 Docker 镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。因此可以考虑使用 <code>registry</code> 简易搭建一个私服仓库。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$  <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
     <span class="token parameter variable">--name</span> registry <span class="token punctuation">\</span>
     <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token punctuation">\</span>
     <span class="token parameter variable">-v</span> registry-data:/var/lib/registry <span class="token punctuation">\</span>
     registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>·基于 dockerc-compose 进行安装 <code>docker-compose.yml</code> <a href="https://zhuanlan.zhihu.com/p/420936752" target="_blank" rel="noopener noreferrer">教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code> version: <span class="token string">'3.0'</span>
 services:
   registry:
     image: registry
     volumes:
       - ./registry-data:/var/lib/registry
   ui:
     image: joxit/docker-registry-ui:static
     ports:
       - <span class="token number">8080</span>:80
     environment:
       - <span class="token assign-left variable">REGISTRY_TITLE</span><span class="token operator">=</span>传智教育私有仓库
       - <span class="token assign-left variable">REGISTRY_URL</span><span class="token operator">=</span>http://registry:5000
     depends_on:
       - registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="docker-进阶"><a href="#docker-进阶" class="header-anchor">#</a> docker 进阶</h2> <h3 id="容器状态"><a href="#容器状态" class="header-anchor">#</a> 容器状态</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>jzy:yunshan-qingyu/ <span class="token punctuation">(</span>feature/jzy✗<span class="token punctuation">)</span> $ <span class="token function">docker</span> stats ubuntu
CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O   PIDS
0ed639cf7c23   ubuntu    <span class="token number">0.00</span>%     <span class="token number">307</span>.3MiB / <span class="token number">18</span>.66GiB   <span class="token number">1.61</span>%     <span class="token number">85</span>.5MB / <span class="token number">1</span>.93MB   0B / 0B     <span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h3> <p>docker 的网络模式有四种</p> <ul><li>bridge</li> <li>host</li> <li>none</li> <li>container</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>☁  ~  <span class="token function">ifconfig</span>
docker0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.1  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255
        inet6 fe80::42:8eff:fec7:4ffc  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether 02:42:8e:c7:4f:fc  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">165347</span>  bytes <span class="token number">33023554</span> <span class="token punctuation">(</span><span class="token number">31.4</span> MiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">194657</span>  bytes <span class="token number">84005495</span> <span class="token punctuation">(</span><span class="token number">80.1</span> MiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.22</span>.5.29  netmask <span class="token number">255.255</span>.192.0  broadcast <span class="token number">172.22</span>.63.255
        inet6 fe80::216:3eff:fe06:bd88  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether 00:16:3e:06:bd:88  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">63504458</span>  bytes <span class="token number">9401012840</span> <span class="token punctuation">(</span><span class="token number">8.7</span> GiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">75738874</span>  bytes <span class="token number">9483268461</span> <span class="token punctuation">(</span><span class="token number">8.8</span> GiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">&gt;</span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
        inet6 ::1  prefixlen <span class="token number">128</span>  scopeid 0x1<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>host<span class="token operator">&gt;</span>
        loop  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span>
        RX packets <span class="token number">10488</span>  bytes <span class="token number">1065854</span> <span class="token punctuation">(</span><span class="token number">1.0</span> MiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">10488</span>  bytes <span class="token number">1065854</span> <span class="token punctuation">(</span><span class="token number">1.0</span> MiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

veth18f2a98: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet6 fe80::f847:17ff:fe5c:2ef2  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether fa:47:17:5c:2e:f2  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">1880</span>  bytes <span class="token number">170610</span> <span class="token punctuation">(</span><span class="token number">166.6</span> KiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">2771</span>  bytes <span class="token number">218901</span> <span class="token punctuation">(</span><span class="token number">213.7</span> KiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

veth7f94c09: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet6 fe80::2054:99ff:feaf:181c  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether <span class="token number">22</span>:54:99:af:18:1c  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">10966</span>  bytes <span class="token number">3627135</span> <span class="token punctuation">(</span><span class="token number">3.4</span> MiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">13283</span>  bytes <span class="token number">1010376</span> <span class="token punctuation">(</span><span class="token number">986.6</span> KiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><code>ifconfig</code> 列出当前主机的网卡情况</p> <ul><li><p><code>eth0</code> 是当前主机的默认网卡</p></li> <li><p><code>docker0</code> 可以理解为是 docker 网桥交换机</p></li> <li><p><code>lo</code> 是本机回环网卡</p></li> <li><p><code>veth</code> 是 docker 容器以 <code>bridge</code> 模式运行虚拟网卡</p></li> <li><p><code>bridge</code> 模式是 docker 默认的模式，每个 docker 容器内部都要自己完整的网卡以及网络设置（<code>eth0</code>），与宿主机交换的过程是通过 docker0 完成。 docker0 会虚拟出 <code>veth</code> 网卡一一对应容器网卡进行网络通信。</p></li> <li><p><code>host</code> 模式指的是容器复用宿主机的网络配置</p></li> <li><p><code>none</code> 模式指的是容器没有网络配置</p></li> <li><p><code>container</code> 模式指的是复用其他容器的网络配置</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 以 bridge 模式的网络状态</span>
/ $ <span class="token function">ifconfig</span>
eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:04
          inet addr:172.17.0.4  Bcast:172.17.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:7 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:586 <span class="token punctuation">(</span><span class="token number">586.0</span> B<span class="token punctuation">)</span>  TX bytes:0 <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>  TX bytes:0 <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="自定义网络"><a href="#自定义网络" class="header-anchor">#</a> 自定义网络</h3> <p>自定义网络的意思是在原有网络的基础上创建新的有标识含义的专有网络给容器使用，可以解决的问题：<u>不同容器之间不能通过容器名 ping 通，可以完美避开之前需要指定固定 ip 才能完成容器之间通信的问题</u></p> <ul><li>默认有的网络 <code>network</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>☁  ~  <span class="token function">docker</span> network <span class="token function">ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
c4416e6f31c3        bridge              bridge              <span class="token builtin class-name">local</span>
28a7a6822118        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
963a4ed0f214        none                null                <span class="token builtin class-name">local</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>创建新的网络。创建新网络默认使用的网络模式是 <code>bridge</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>☁  ~  <span class="token function">docker</span> network create base
32c2fe4fc21df6f0e808444a48f7b00f9adfc16aacc0e4b2e3d2d82b5e747892
☁  ~  <span class="token function">docker</span> network <span class="token function">ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
32c2fe4fc21d        base                bridge              <span class="token builtin class-name">local</span>
c4416e6f31c3        bridge              bridge              <span class="token builtin class-name">local</span>
28a7a6822118        <span class="token function">host</span>                <span class="token function">host</span>                <span class="token builtin class-name">local</span>
963a4ed0f214        none                null                <span class="token builtin class-name">local</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>把容器加入到指定网路 <code>--network</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>☁  ~  <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> alpine <span class="token parameter variable">--network</span> base alpine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看当前容器网络情况 <code>inspect</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>☁  ~  <span class="token function">docker</span> inspect alpine <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-n</span> <span class="token number">22</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;base&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;f1b7ec152df4&quot;</span>
                    <span class="token punctuation">]</span>,
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;32c2fe4fc21df6f0e808444a48f7b00f9adfc16aacc0e4b2e3d2d82b5e747892&quot;</span>,
                    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1e5a88d58794e30464cd215a671cb34c804c196a68daf527380795b50c4a3998&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.18.0.1&quot;</span>,
                    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.18.0.2&quot;</span>,
                    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
                    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:12:00:02&quot;</span>,
                    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h3> <blockquote><p>Dockerfile 本质上就是通过关键字（保留字）创建层层镜像 <a href="https://yeasy.gitbook.io/docker_practice/appendix/best_practices#dockerfile-zhi-ling" target="_blank" rel="noopener noreferrer">Dockerfile 最佳实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>Dockerfile 构建流程</p> <ul><li>docker 从基础镜像运行一个容器</li> <li>执行一条指令并对容器进行修改</li> <li>执行类似 docker commit 的操作提交一个新的容器</li> <li>docker 再基于刚提交的镜像运行一个新容器</li> <li>执行 dockerfile 中的下一条指令直至所有指令执行完成</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>☁  yunshan-qingyu <span class="token punctuation">[</span>feature/jzy<span class="token punctuation">]</span> ⚡ <span class="token function">docker</span> build <span class="token parameter variable">-t</span> yunshan-qingyu <span class="token builtin class-name">.</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">291</span>.6s <span class="token punctuation">(</span><span class="token number">14</span>/14<span class="token punctuation">)</span> FINISHED
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build definition from Dockerfile                   <span class="token number">0</span>.1s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring dockerfile: 280B                                   <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load .dockerignore                                      <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring context: 136B                                      <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/nginx:alpine        <span class="token number">0</span>.3s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load metadata <span class="token keyword">for</span> docker.io/library/node:16-alpine     <span class="token number">15</span>.3s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span>stage-1 <span class="token number">1</span>/2<span class="token punctuation">]</span> FROM docker.io/library/nginx:alpine@sha256:e  <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>internal<span class="token punctuation">]</span> load build context                                    <span class="token number">229</span>.1s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> transferring context: <span class="token number">455</span>.08MB                                <span class="token number">229</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>builder <span class="token number">1</span>/6<span class="token punctuation">]</span> FROM docker.io/library/node:16-alpine@sha256:0e071f  <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span>builder <span class="token number">2</span>/6<span class="token punctuation">]</span> WORKDIR /build                                <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span>builder <span class="token number">3</span>/6<span class="token punctuation">]</span> COPY package*.json /build                     <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> CACHED <span class="token punctuation">[</span>builder <span class="token number">4</span>/6<span class="token punctuation">]</span> RUN <span class="token function">npm</span> ci                                    <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>builder <span class="token number">5</span>/6<span class="token punctuation">]</span> COPY <span class="token builtin class-name">.</span> /build                                        <span class="token number">9</span>.2s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>builder <span class="token number">6</span>/6<span class="token punctuation">]</span> RUN <span class="token function">npm</span> run build                                   <span class="token number">36</span>.5s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>stage-1 <span class="token number">2</span>/2<span class="token punctuation">]</span> COPY <span class="token parameter variable">--from</span><span class="token operator">=</span>builder /build/yunshan-qingyu /usr/shar  <span class="token number">0</span>.1s
 <span class="token operator">=</span><span class="token operator">&gt;</span> exporting to image                                                 <span class="token number">0</span>.1s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> exporting layers                                                <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> writing image sha256:b6c5f661bebcdf06ced43007292ee85ad64e750c0  <span class="token number">0</span>.0s
 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> naming to docker.io/library/yunshan-qingyu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="from"><a href="#from" class="header-anchor">#</a> FROM</h4> <blockquote><p>基于 docker hub 仓库的远程镜像</p></blockquote> <h4 id="maintainer"><a href="#maintainer" class="header-anchor">#</a> MAINTAINER</h4> <blockquote><p>镜像作者</p></blockquote> <h4 id="run"><a href="#run" class="header-anchor">#</a> RUN</h4> <blockquote><p>等价于在某个容器内部执行 bash / shell 等脚本命令</p></blockquote> <h1 id="docker-compose"><a href="#docker-compose" class="header-anchor">#</a> docker compose</h1> <p>[^背景]: 在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等</p> <p>compose 可以理解为是使用一个<code>docker-compose.yml</code>配置文件管理若干的容器的启动来实现容器编排。</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$  <span class="token function">curl</span> <span class="token parameter variable">-L</span> https://github.com/docker/compose/releases/download/1.23.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
<span class="token comment"># 速度太慢，改用中国镜像</span>
$ <span class="token function">curl</span> <span class="token parameter variable">-L</span> https://get.daocloud.io/docker/compose/releases/download/1.29.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>·配置执行权限</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>·添加 bash 补全命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$  <span class="token function">curl</span> <span class="token parameter variable">-L</span> https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>·如果上述出现错误，大概就是 DNS 相关问题了</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$  <span class="token builtin class-name">echo</span> <span class="token string">&quot;199.232.68.133 raw.githubusercontent.com&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="基础配置"><a href="#基础配置" class="header-anchor">#</a> 基础配置</h2> <p>以下为基于 flask 嵌入 redis 的 docker-compose.yml 配置</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">ocr</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> flask
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3500<span class="token punctuation">:</span><span class="token number">5000</span>
    <span class="token key atrule">links</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> redis
    <span class="token key atrule">volumesdocker-compose 整体是将若干个docker任务组装起来的工具，解决多任务/多服务部署的场景</span>

<span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/share/nltk_data<span class="token punctuation">:</span>/root/nltk_data
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 设置容器权限为 root(不安全)</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>alpine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="network"><a href="#network" class="header-anchor">#</a> network</h3> <p>compose 在应用启动的时候会建立一个默认网络，名称为 docker-compose.yml 所在目录名称小写形式加上 <code>_default</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>❯ <span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> ~/Documents/compose/wechat.yml up <span class="token parameter variable">-d</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Building <span class="token number">0</span>.0s <span class="token punctuation">(</span><span class="token number">0</span>/0<span class="token punctuation">)</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Running <span class="token number">2</span>/2
 ✔ Network compose_default  Created                                        <span class="token number">0</span>.2s
 ✔ Container wechat         Started                                        <span class="token number">0</span>.8s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>ℹ️ 但是可能存在这么一个场景：我在一个文件系统中存在多个 compose 文件，对应的比如有 nginx、wechat 等等，每次启动的时候其实我并不想他们公用一个网络，此时就需要自定义 network</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">wechat_net</span><span class="token punctuation">:</span> <span class="token comment"># 容器网络的别名</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> wechat <span class="token comment"># 真正创建出来的名字</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>以上 compose 会自动创建一个名为 wechat 的网络</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx_net</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx <span class="token comment"># docker全局存在的网络名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>以上方式是基于 docker 已经存在 wechat 网络的基础上，如果不存在可以先创建</p> <p>官网对 network 定义的说明：https://docs.docker.com/compose/networking/</p> <h3 id="volumes"><a href="#volumes" class="header-anchor">#</a> volumes</h3> <p>compose 通常我们在写的时候都会涉及到目录挂载来保障容器销毁时数据不会随着消失，比如说像下面的 <code>nginx</code></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8088<span class="token punctuation">:</span><span class="token number">80</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /home/jzy/nginx<span class="token punctuation">:</span>/etc/nginx
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>但是其实上面写是有问题的，首先理解下 <code>volume mount</code> &amp; <code>bind mount</code>，两者都是都是绕过了 container 文件系统，但使用上有区别</p> <ul><li><code>volume mount</code> 由 docker 管理，数据存储在<code>/var/lib/docker/volumes/[volume_name]/_data</code></li> <li><code>bind mount</code> 则完全是依赖于主机的目录结构和操作系统</li></ul> <blockquote><p>⚠️ 实际使用注意：如果绑定挂载到容器中的一个非空的目录且当前主机上的目录为空的话，<code>volume</code> 会拷贝容器目录的内容，而 <code>bind</code> 会直接清空 <a href="https://www.cnblogs.com/chuanzhang053/p/16620053.html" target="_blank" rel="noopener noreferrer">说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>因此对于上面 <code>docker-compose</code> 启动 <code>nginx</code>，一开始主机上的目录肯定是空，那么实际也一定会把容器内容清空 ，因此最好使用 <code>volumes</code>，不然就得先自己去启动一个 <code>nginx</code> 容器然后再通过拷贝文件的方式拷贝到宿主机（以上的解决方法）</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8088<span class="token punctuation">:</span><span class="token number">80</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nginx<span class="token punctuation">:</span>/etc/nginx
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nginx
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="应用启动"><a href="#应用启动" class="header-anchor">#</a> 应用启动</h3> <blockquote><p>包含各种应用启动的配置文件</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql
    <span class="token comment"># restart: always</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> jzy
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3306</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ~/docker<span class="token punctuation">-</span>compose/mysql/data<span class="token punctuation">:</span>/var/lib/mysql
      <span class="token punctuation">-</span> ~/docker<span class="token punctuation">-</span>compose/mysql/config/my.cnf<span class="token punctuation">:</span>/etc/mysql/my.cnf
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>max_connections=1000
      <span class="token punctuation">-</span><span class="token punctuation">-</span>character<span class="token punctuation">-</span>set<span class="token punctuation">-</span>server=utf8mb4
      <span class="token punctuation">-</span><span class="token punctuation">-</span>collation<span class="token punctuation">-</span>server=utf8mb4_general_ci
      <span class="token punctuation">-</span><span class="token punctuation">-</span>default<span class="token punctuation">-</span>authentication<span class="token punctuation">-</span>plugin=mysql_native_password
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div> <footer class="page-edit page-editor"><div class="edit-link"><a href="https://github.com/jzyismylover/ubuntu-markdown/edit/docs/backend/docker/docker.md" target="_blank" rel="noopener noreferrer">完善页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">3/17/2024, 9:24:20 AM</span></div></footer> <!----></div> <div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:86vh"><div style="font-weight:bold;">docker</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/markdown/docker/#背景" class="toc-sidebar-link">背景</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#场景一-单机" class="toc-sidebar-link">场景一：单机</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#场景二-多机" class="toc-sidebar-link">场景二：多机</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#容器技术-vs-虚拟机技术" class="toc-sidebar-link">容器技术 VS 虚拟机技术</a></li></ul></li><li><a href="/markdown/docker/#基础命令" class="toc-sidebar-link">基础命令</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#联合文件系统" class="toc-sidebar-link">联合文件系统</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#提交新镜像" class="toc-sidebar-link">提交新镜像</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#容器与宿主机通信" class="toc-sidebar-link">容器与宿主机通信</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#容器数据卷" class="toc-sidebar-link">容器数据卷</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#部件安装" class="toc-sidebar-link">部件安装</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#安装-mysql" class="toc-sidebar-link">安装 mysql</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#安装-gitlab" class="toc-sidebar-link">安装 gitlab</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#安装-gitlab-runner" class="toc-sidebar-link">安装 gitlab-runner</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#安装-jenkins" class="toc-sidebar-link">安装 jenkins</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#安装-redis" class="toc-sidebar-link">安装 redis</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#安装-registry" class="toc-sidebar-link">安装 registry</a></li></ul></li><li><a href="/markdown/docker/#docker-进阶" class="toc-sidebar-link">docker 进阶</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#容器状态" class="toc-sidebar-link">容器状态</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#网络" class="toc-sidebar-link">网络</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#自定义网络" class="toc-sidebar-link">自定义网络</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#dockerfile" class="toc-sidebar-link">Dockerfile</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/docker/#from" class="toc-sidebar-link">FROM</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/docker/#maintainer" class="toc-sidebar-link">MAINTAINER</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/docker/#run" class="toc-sidebar-link">RUN</a></li></ul></li><li><a href="/markdown/docker/#安装" class="toc-sidebar-link">安装</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/docker/#基础配置" class="toc-sidebar-link">基础配置</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#network" class="toc-sidebar-link">network</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#volumes" class="toc-sidebar-link">volumes</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/docker/#应用启动" class="toc-sidebar-link">应用启动</a></li></ul></li></ul></div></div></div></div></div>  <div></div></main> <aside class="page-sidebar"> <div class="page-side-toolbar"></div>  </aside></div><div class="global-ui"><!----></div></div>
    <script src="/markdown/assets/js/app.085aa012.js" defer></script><script src="/markdown/assets/js/2.773263cd.js" defer></script><script src="/markdown/assets/js/36.c13df5f5.js" defer></script>
  </body>
</html>
