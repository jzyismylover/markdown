<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx | Mr.Jiang-技术博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?2675818a983a3131404cee835018f016";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script>
    <meta name="description" content="学习&amp;工作-技术积累">
    
    <link rel="preload" href="/markdown/assets/css/0.styles.5474aed4.css" as="style"><link rel="preload" href="/markdown/assets/js/app.085aa012.js" as="script"><link rel="preload" href="/markdown/assets/js/2.773263cd.js" as="script"><link rel="preload" href="/markdown/assets/js/52.90aa4f80.js" as="script"><link rel="prefetch" href="/markdown/assets/js/1.50bc9635.js"><link rel="prefetch" href="/markdown/assets/js/10.121e7e8f.js"><link rel="prefetch" href="/markdown/assets/js/11.5205ffab.js"><link rel="prefetch" href="/markdown/assets/js/12.fef29d74.js"><link rel="prefetch" href="/markdown/assets/js/13.b581db50.js"><link rel="prefetch" href="/markdown/assets/js/14.07202c28.js"><link rel="prefetch" href="/markdown/assets/js/15.9aedb95a.js"><link rel="prefetch" href="/markdown/assets/js/16.dd97e264.js"><link rel="prefetch" href="/markdown/assets/js/17.8eb943fb.js"><link rel="prefetch" href="/markdown/assets/js/18.942cde78.js"><link rel="prefetch" href="/markdown/assets/js/19.44710683.js"><link rel="prefetch" href="/markdown/assets/js/20.22d46747.js"><link rel="prefetch" href="/markdown/assets/js/21.aa8b4011.js"><link rel="prefetch" href="/markdown/assets/js/22.b40024cc.js"><link rel="prefetch" href="/markdown/assets/js/23.ace5d346.js"><link rel="prefetch" href="/markdown/assets/js/24.2405d60a.js"><link rel="prefetch" href="/markdown/assets/js/25.c08a85e2.js"><link rel="prefetch" href="/markdown/assets/js/26.c4c5f267.js"><link rel="prefetch" href="/markdown/assets/js/27.b91e5849.js"><link rel="prefetch" href="/markdown/assets/js/28.b80c3633.js"><link rel="prefetch" href="/markdown/assets/js/29.594ec447.js"><link rel="prefetch" href="/markdown/assets/js/3.9d4223ad.js"><link rel="prefetch" href="/markdown/assets/js/30.324e278d.js"><link rel="prefetch" href="/markdown/assets/js/31.43dc2191.js"><link rel="prefetch" href="/markdown/assets/js/32.3fb01abd.js"><link rel="prefetch" href="/markdown/assets/js/33.5a2693b9.js"><link rel="prefetch" href="/markdown/assets/js/34.637d4661.js"><link rel="prefetch" href="/markdown/assets/js/35.eccfebaa.js"><link rel="prefetch" href="/markdown/assets/js/36.c13df5f5.js"><link rel="prefetch" href="/markdown/assets/js/37.9890e89c.js"><link rel="prefetch" href="/markdown/assets/js/38.b33827f2.js"><link rel="prefetch" href="/markdown/assets/js/39.3a1ace37.js"><link rel="prefetch" href="/markdown/assets/js/4.27d6f5b1.js"><link rel="prefetch" href="/markdown/assets/js/40.4396d4c2.js"><link rel="prefetch" href="/markdown/assets/js/41.afe775e0.js"><link rel="prefetch" href="/markdown/assets/js/42.19b2951c.js"><link rel="prefetch" href="/markdown/assets/js/43.7c3256ea.js"><link rel="prefetch" href="/markdown/assets/js/44.7da308e4.js"><link rel="prefetch" href="/markdown/assets/js/45.89b2fd21.js"><link rel="prefetch" href="/markdown/assets/js/46.e817e45d.js"><link rel="prefetch" href="/markdown/assets/js/47.c56ee626.js"><link rel="prefetch" href="/markdown/assets/js/48.59541039.js"><link rel="prefetch" href="/markdown/assets/js/49.bc7ad96a.js"><link rel="prefetch" href="/markdown/assets/js/5.2637f2cc.js"><link rel="prefetch" href="/markdown/assets/js/50.9d0dc446.js"><link rel="prefetch" href="/markdown/assets/js/51.4d949834.js"><link rel="prefetch" href="/markdown/assets/js/53.67b77129.js"><link rel="prefetch" href="/markdown/assets/js/54.3535db37.js"><link rel="prefetch" href="/markdown/assets/js/55.9efbe9e5.js"><link rel="prefetch" href="/markdown/assets/js/56.e8aa37ba.js"><link rel="prefetch" href="/markdown/assets/js/57.af66ff8f.js"><link rel="prefetch" href="/markdown/assets/js/58.0415674f.js"><link rel="prefetch" href="/markdown/assets/js/59.b09373ca.js"><link rel="prefetch" href="/markdown/assets/js/6.61bacfb8.js"><link rel="prefetch" href="/markdown/assets/js/60.d07cb515.js"><link rel="prefetch" href="/markdown/assets/js/61.ec2b2da7.js"><link rel="prefetch" href="/markdown/assets/js/62.44a5a0b8.js"><link rel="prefetch" href="/markdown/assets/js/63.09e39adc.js"><link rel="prefetch" href="/markdown/assets/js/64.b9ee085d.js"><link rel="prefetch" href="/markdown/assets/js/65.026450b0.js"><link rel="prefetch" href="/markdown/assets/js/66.a3571972.js"><link rel="prefetch" href="/markdown/assets/js/67.5a8616c4.js"><link rel="prefetch" href="/markdown/assets/js/68.6fdda787.js"><link rel="prefetch" href="/markdown/assets/js/69.691ff5d7.js"><link rel="prefetch" href="/markdown/assets/js/7.32a4bd87.js"><link rel="prefetch" href="/markdown/assets/js/70.b401009e.js"><link rel="prefetch" href="/markdown/assets/js/71.6b3bcefe.js"><link rel="prefetch" href="/markdown/assets/js/72.dcd8145e.js"><link rel="prefetch" href="/markdown/assets/js/73.cc81c046.js"><link rel="prefetch" href="/markdown/assets/js/74.856f40f0.js"><link rel="prefetch" href="/markdown/assets/js/75.746590de.js"><link rel="prefetch" href="/markdown/assets/js/76.8ddba5b5.js"><link rel="prefetch" href="/markdown/assets/js/77.16644476.js"><link rel="prefetch" href="/markdown/assets/js/78.e89fc885.js"><link rel="prefetch" href="/markdown/assets/js/79.1193b665.js"><link rel="prefetch" href="/markdown/assets/js/80.9475cd89.js"><link rel="prefetch" href="/markdown/assets/js/81.8d99d275.js"><link rel="prefetch" href="/markdown/assets/js/82.80eb3e2f.js"><link rel="prefetch" href="/markdown/assets/js/83.fe14141e.js"><link rel="prefetch" href="/markdown/assets/js/84.9647a2db.js"><link rel="prefetch" href="/markdown/assets/js/85.c7258f01.js"><link rel="prefetch" href="/markdown/assets/js/86.1a5782f4.js"><link rel="prefetch" href="/markdown/assets/js/87.e7354607.js"><link rel="prefetch" href="/markdown/assets/js/vendors~docsearch.54f2532f.js">
    <link rel="stylesheet" href="/markdown/assets/css/0.styles.5474aed4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown/" class="home-link router-link-active"><img src="/markdown/logo.png" alt="Mr.Jiang-技术博客" class="logo"> <span class="site-name can-hide">Mr.Jiang-技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/markdown/nginx/#配置文件" class="sidebar-link">配置文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#反向代理" class="sidebar-link">反向代理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#负载均衡" class="sidebar-link">负载均衡</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#应用问题" class="sidebar-link">应用问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#路径匹配规则" class="sidebar-link">路径匹配规则</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content"><div class="content-wrapper" style="width:100%"><div class="theme-default-content custom-content content__default"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h1> <blockquote><p>一句话介绍 ：<code>nginx</code> 是开源轻量 web 服务器，能实现反向代理、负载均衡</p></blockquote> <h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <p><code>nginx</code> 配置文件基本由三部分组成</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">..</span>.              <span class="token comment">#全局块</span>

events <span class="token punctuation">{</span>         <span class="token comment">#events块</span>
   <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>

http      <span class="token comment">#http块</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">..</span>.   <span class="token comment">#http全局块</span>
    server        <span class="token comment">#server块</span>
    <span class="token punctuation">{</span> 
        <span class="token punctuation">..</span>.       <span class="token comment">#server全局块</span>
        location <span class="token punctuation">[</span>PATTERN<span class="token punctuation">]</span>   <span class="token comment">#location块</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">..</span>.
        <span class="token punctuation">}</span>
        location <span class="token punctuation">[</span>PATTERN<span class="token punctuation">]</span> 
        <span class="token punctuation">{</span>
            <span class="token punctuation">..</span>.
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    server
    <span class="token punctuation">{</span>
      <span class="token punctuation">..</span>.
    <span class="token punctuation">}</span>
    <span class="token punctuation">..</span>.     <span class="token comment">#http全局块</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li><p>全局块：设置一些影响 nginx 服务器整体运行的配置指令</p></li> <li><p>events块：影响nginx服务器与用户的网络连接</p></li> <li><p>http 块：包括http全局块和server块，是服务器配置中最频繁的部分，包括配置代理、缓存、日志定义等绝大多数功能</p> <ul><li>server：配置虚拟主机相关参数</li> <li>location：配置请求路由，以及各种页面的处理</li></ul></li></ul> <h2 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h2> <p>反向代理通常指的是在服务端设置一个中间者的角色，以此作为桥梁访问实际需要访问的域名。</p> <blockquote><p>客户端对代理服务器是无感知的，客户端不需要做任何配置，用户只请求反向代理服务器，反向代理服务器选择目标服务器，获取数据后再返回给客户端。反向代理服务器和目标服务器对外而言就是一个服务器，只是暴露的是代理服务器地址，而隐藏了真实服务器的IP地址。</p></blockquote> <p>反向代理有什么用？</p> <ul><li>负载均衡：合理分配服务器负载</li> <li>请求缓存：应对一段时间内多个相同资源请求，首次请求资源获得结果则缓存，下次重新请求的时候可以直接从缓存中获取数据而不需要在通过代理转接到目的服务器重新获取。</li> <li>安全：作为代理服务请求不直接送达目的主机，可对某些恶意请求进行过滤</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost; <span class="token comment"># 监听的主机</span>

    <span class="token comment">#access_log  /var/log/nginx/host.access.log  main;</span>

    location / <span class="token punctuation">{</span>
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    <span class="token punctuation">}</span>
	
	<span class="token comment"># 通过 nest1 nest2 区分两个不同的服务</span>
	
    location /nest1 <span class="token punctuation">{</span>
      rewrite ^/nest1/(.<span class="token important">*)</span> /$1 break;
      proxy_pass http<span class="token punctuation">:</span>//10.173.113.95<span class="token punctuation">:</span>3000; <span class="token comment"># 代理到指定地址</span>
      <span class="token comment"># 以下是为了解决跨域问题</span>
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Methods' 'GET<span class="token punctuation">,</span>OPTIONS<span class="token punctuation">,</span>POST' always;
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin' $http_origin always;
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Headers' 'Authorization<span class="token punctuation">,</span> Content<span class="token punctuation">-</span>Type<span class="token punctuation">,</span> X<span class="token punctuation">-</span>Requested<span class="token punctuation">-</span>With<span class="token punctuation">,</span> Cache<span class="token punctuation">-</span>Control' always;
      if ($request_method = OPTIONS ) <span class="token punctuation">{</span> return 200; <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    location /nest2 <span class="token punctuation">{</span>
      rewrite ^/nest2/(.<span class="token important">*)</span> /$1 break;
      proxy_pass http<span class="token punctuation">:</span>//10.173.113.95<span class="token punctuation">:</span>3001;
      <span class="token comment"># 以下是为了解决跨域问题</span>
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Methods' 'GET<span class="token punctuation">,</span>OPTIONS<span class="token punctuation">,</span>POST' always;
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin' $http_origin always;
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Headers' 'Authorization<span class="token punctuation">,</span> Content<span class="token punctuation">-</span>Type<span class="token punctuation">,</span> X<span class="token punctuation">-</span>Requested<span class="token punctuation">-</span>With<span class="token punctuation">,</span> Cache<span class="token punctuation">-</span>Control' always;
      if ($request_method = OPTIONS ) <span class="token punctuation">{</span> return 200; <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

   
    error_page   500 502 503 504  /50x.html;
    location = /50x.html <span class="token punctuation">{</span>
        root   /usr/share/nginx/html;
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h2 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h2> <p>负载均衡主要的策略就是实际在请求的时候面向一个地址比如 <code>localhost:8080</code>，但实际在处理请求的时候通过权重分配把请求更多地分发到空闲的机子上保证资源分配处理合理性。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 定义当前负载的主机名</span>
upstream nest_server<span class="token punctuation">{</span>
  server 10.173.113.95<span class="token punctuation">:</span>3000 weight=2; <span class="token comment">#定义权重</span>
  server 10.173.113.95<span class="token punctuation">:</span>3001 weight=1;
  <span class="token comment">#每有请求到达nest_server，按照两个到1号机一个到2号机的策略进行分配</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen       80;
    listen  <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>80;
    server_name  localhost; <span class="token comment"># 监听的主机</span>
	
    location /nest1 <span class="token punctuation">{</span>
      rewrite ^/nest1/(.<span class="token important">*)</span> /$1 break;
      proxy_pass http<span class="token punctuation">:</span>//nest_server; <span class="token comment"># 代理到指定地址</span>
      <span class="token comment"># 以下是为了解决跨域问题</span>
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Methods' 'GET<span class="token punctuation">,</span>OPTIONS<span class="token punctuation">,</span>POST' always;
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin' $http_origin always;
      add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Headers' 'Authorization<span class="token punctuation">,</span> Content<span class="token punctuation">-</span>Type<span class="token punctuation">,</span> X<span class="token punctuation">-</span>Requested<span class="token punctuation">-</span>With<span class="token punctuation">,</span> Cache<span class="token punctuation">-</span>Control' always;
      if ($request_method = OPTIONS ) <span class="token punctuation">{</span> return 200; <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="应用问题"><a href="#应用问题" class="header-anchor">#</a> 应用问题</h2> <ol><li>实际 location 配置过程中通常会出现对 / 的疑问 <a href="https://juejin.cn/post/7083306471697416228" target="_blank" rel="noopener noreferrer">demo 说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，比如</li></ol> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>location /nest1 <span class="token punctuation">{</span>
	proxy_pass http<span class="token punctuation">:</span>//xxx.xxx.xxx.xxx <span class="token comment"># 以下替换为 target</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>location /nest1/ <span class="token punctuation">{</span>
	proxy_pass http<span class="token punctuation">:</span>//xxx.xxx.xxx.xxx/
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>以上两者的效果其实完全不一样，假设当前nginx监听的 server_name = <code>localhost</code>假如请求的是 <code>http://localhost/nest1/start</code></p> <ul><li><p>第一个实际会转发到 <code>http://target/nest1/start</code></p></li> <li><p>第二个实际会转发到 <code>http://target/start</code></p></li></ul> <p>因此在实际使用的时候要考虑是否需要保留前缀别名段</p> <ol start="2"><li>实际在配置 proxy_pass 的时候</li></ol> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>proxy_pass http<span class="token punctuation">:</span>//localhost
proxy_pass http<span class="token punctuation">:</span>//127.0.0.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上面两种写法其实都会出现 502 bad gateway 的报错</p> <h2 id="路径匹配规则"><a href="#路径匹配规则" class="header-anchor">#</a> 路径匹配规则</h2> <p>—— <a href="https://www.cnblogs.com/yuncong/p/12427480.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <table><thead><tr><th>模式</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td>location = /uri</td> <td style="text-align:left;">= 表示精确匹配，只有完全匹配上才能生效</td></tr> <tr><td>location ^~ /uri</td> <td style="text-align:left;">^~ 开头对URL路径进行前缀匹配，并且在正则之前。</td></tr> <tr><td>location ~ pattern</td> <td style="text-align:left;">开头表示区分大小写的正则匹配</td></tr> <tr><td>location ~* pattern</td> <td style="text-align:left;">开头表示不区分大小写的正则匹配</td></tr> <tr><td>location /uri</td> <td style="text-align:left;">不带任何修饰符，也表示前缀匹配，但是在正则匹配之后</td></tr> <tr><td>location /</td> <td style="text-align:left;">通用匹配，任何未匹配到其它location的请求都会匹配到，相当于switch中的default</td></tr></tbody></table> <ul><li>首先精确匹配 <code>=</code></li> <li>其次前缀匹配 <code>^~</code></li> <li>其次是按文件中顺序的正则匹配</li> <li>然后匹配不带任何修饰的前缀匹配。</li> <li>最后是交给 <code>/</code> 通用匹配</li> <li>当有匹配成功时候，停止匹配，按当前匹配规则处理请求</li></ul> <blockquote><p>注意：前缀匹配，如果有包含关系时，按<strong>最大匹配原则</strong>进行匹配。比如在前缀匹配：<code>location /dir01</code> 与 <code>location /dir01/dir02</code>，如有请求 <code>http://localhost/dir01/dir02/file</code> 将最终匹配到 <code>location /dir01/dir02</code></p></blockquote></div> <footer class="page-edit page-editor"><div class="edit-link"><a href="https://github.com/jzyismylover/ubuntu-markdown/edit/docs/backend/nginx/nginx.md" target="_blank" rel="noopener noreferrer">完善页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">3/17/2024, 9:24:20 AM</span></div></footer> <!----></div> <div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:86vh"><div style="font-weight:bold;">nginx</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/markdown/nginx/#配置文件" class="toc-sidebar-link">配置文件</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#反向代理" class="toc-sidebar-link">反向代理</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#负载均衡" class="toc-sidebar-link">负载均衡</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#应用问题" class="toc-sidebar-link">应用问题</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/nginx/#路径匹配规则" class="toc-sidebar-link">路径匹配规则</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div>  <div></div></main> <aside class="page-sidebar"> <div class="page-side-toolbar"></div>  </aside></div><div class="global-ui"><!----></div></div>
    <script src="/markdown/assets/js/app.085aa012.js" defer></script><script src="/markdown/assets/js/2.773263cd.js" defer></script><script src="/markdown/assets/js/52.90aa4f80.js" defer></script>
  </body>
</html>
