(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{405:function(t,s,n){"use strict";n.r(s);var a=n(4),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" nginx")]),t._v(" "),s("blockquote",[s("p",[t._v("一句话介绍 ："),s("code",[t._v("nginx")]),t._v(" 是开源轻量 web 服务器，能实现反向代理、负载均衡")])]),t._v(" "),s("h2",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),s("p",[s("code",[t._v("nginx")]),t._v(" 配置文件基本由三部分组成")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#全局块")]),t._v("\n\nevents "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#events块")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http块")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http全局块")]),t._v("\n    server        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#server块")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#server全局块")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("PATTERN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location块")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        location "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("PATTERN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    server\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#http全局块")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])]),s("ul",[s("li",[s("p",[t._v("全局块：设置一些影响 nginx 服务器整体运行的配置指令")])]),t._v(" "),s("li",[s("p",[t._v("events块：影响nginx服务器与用户的网络连接")])]),t._v(" "),s("li",[s("p",[t._v("http 块：包括http全局块和server块，是服务器配置中最频繁的部分，包括配置代理、缓存、日志定义等绝大多数功能")]),t._v(" "),s("ul",[s("li",[t._v("server：配置虚拟主机相关参数")]),t._v(" "),s("li",[t._v("location：配置请求路由，以及各种页面的处理")])])])]),t._v(" "),s("h2",{attrs:{id:"反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[t._v("#")]),t._v(" 反向代理")]),t._v(" "),s("p",[t._v("反向代理通常指的是在服务端设置一个中间者的角色，以此作为桥梁访问实际需要访问的域名。")]),t._v(" "),s("blockquote",[s("p",[t._v("客户端对代理服务器是无感知的，客户端不需要做任何配置，用户只请求反向代理服务器，反向代理服务器选择目标服务器，获取数据后再返回给客户端。反向代理服务器和目标服务器对外而言就是一个服务器，只是暴露的是代理服务器地址，而隐藏了真实服务器的IP地址。")])]),t._v(" "),s("p",[t._v("反向代理有什么用？")]),t._v(" "),s("ul",[s("li",[t._v("负载均衡：合理分配服务器负载")]),t._v(" "),s("li",[t._v("请求缓存：应对一段时间内多个相同资源请求，首次请求资源获得结果则缓存，下次重新请求的时候可以直接从缓存中获取数据而不需要在通过代理转接到目的服务器重新获取。")]),t._v(" "),s("li",[t._v("安全：作为代理服务请求不直接送达目的主机，可对某些恶意请求进行过滤")])]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       80;\n    listen  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80;\n    server_name  localhost; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听的主机")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  /var/log/nginx/host.access.log  main;")]),t._v("\n\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通过 nest1 nest2 区分两个不同的服务")]),t._v("\n\t\n    location /nest1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      rewrite ^/nest1/(."),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*)")]),t._v(" /$1 break;\n      proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//10.173.113.95"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3000; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代理到指定地址")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以下是为了解决跨域问题")]),t._v("\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Methods' 'GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("POST' always;\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Origin' $http_origin always;\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Headers' 'Authorization"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Requested"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("With"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control' always;\n      if ($request_method = OPTIONS ) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" return 200; "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    location /nest2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      rewrite ^/nest2/(."),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*)")]),t._v(" /$1 break;\n      proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//10.173.113.95"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3001;\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以下是为了解决跨域问题")]),t._v("\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Methods' 'GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("POST' always;\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Origin' $http_origin always;\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Headers' 'Authorization"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Requested"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("With"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control' always;\n      if ($request_method = OPTIONS ) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" return 200; "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n   \n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br")])]),s("h2",{attrs:{id:"负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[t._v("#")]),t._v(" 负载均衡")]),t._v(" "),s("p",[t._v("负载均衡主要的策略就是实际在请求的时候面向一个地址比如 "),s("code",[t._v("localhost:8080")]),t._v("，但实际在处理请求的时候通过权重分配把请求更多地分发到空闲的机子上保证资源分配处理合理性。")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义当前负载的主机名")]),t._v("\nupstream nest_server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server 10.173.113.95"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3000 weight=2; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#定义权重")]),t._v("\n  server 10.173.113.95"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3001 weight=1;\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#每有请求到达nest_server，按照两个到1号机一个到2号机的策略进行分配")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       80;\n    listen  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80;\n    server_name  localhost; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听的主机")]),t._v("\n\t\n    location /nest1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      rewrite ^/nest1/(."),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*)")]),t._v(" /$1 break;\n      proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//nest_server; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代理到指定地址")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以下是为了解决跨域问题")]),t._v("\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Methods' 'GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("POST' always;\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Origin' $http_origin always;\n      add_header 'Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Headers' 'Authorization"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Requested"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("With"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control' always;\n      if ($request_method = OPTIONS ) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" return 200; "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br")])]),s("h2",{attrs:{id:"应用问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用问题"}},[t._v("#")]),t._v(" 应用问题")]),t._v(" "),s("ol",[s("li",[t._v("实际 location 配置过程中通常会出现对 / 的疑问 "),s("a",{attrs:{href:"https://juejin.cn/post/7083306471697416228",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo 说明"),s("OutboundLink")],1),t._v("，比如")])]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("location /nest1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tproxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//xxx.xxx.xxx.xxx "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以下替换为 target")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("location /nest1/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tproxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//xxx.xxx.xxx.xxx/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("以上两者的效果其实完全不一样，假设当前nginx监听的 server_name = "),s("code",[t._v("localhost")]),t._v("假如请求的是 "),s("code",[t._v("http://localhost/nest1/start")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("第一个实际会转发到 "),s("code",[t._v("http://target/nest1/start")])])]),t._v(" "),s("li",[s("p",[t._v("第二个实际会转发到 "),s("code",[t._v("http://target/start")])])])]),t._v(" "),s("p",[t._v("因此在实际使用的时候要考虑是否需要保留前缀别名段")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("实际在配置 proxy_pass 的时候")])]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost\nproxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("上面两种写法其实都会出现 502 bad gateway 的报错")]),t._v(" "),s("h2",{attrs:{id:"路径匹配规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路径匹配规则"}},[t._v("#")]),t._v(" 路径匹配规则")]),t._v(" "),s("p",[t._v("—— "),s("a",{attrs:{href:"https://www.cnblogs.com/yuncong/p/12427480.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),s("OutboundLink")],1)]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("模式")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("location = /uri")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("= 表示精确匹配，只有完全匹配上才能生效")])]),t._v(" "),s("tr",[s("td",[t._v("location ^~ /uri")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("^~ 开头对URL路径进行前缀匹配，并且在正则之前。")])]),t._v(" "),s("tr",[s("td",[t._v("location ~ pattern")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("开头表示区分大小写的正则匹配")])]),t._v(" "),s("tr",[s("td",[t._v("location ~* pattern")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("开头表示不区分大小写的正则匹配")])]),t._v(" "),s("tr",[s("td",[t._v("location /uri")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("不带任何修饰符，也表示前缀匹配，但是在正则匹配之后")])]),t._v(" "),s("tr",[s("td",[t._v("location /")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("通用匹配，任何未匹配到其它location的请求都会匹配到，相当于switch中的default")])])])]),t._v(" "),s("ul",[s("li",[t._v("首先精确匹配 "),s("code",[t._v("=")])]),t._v(" "),s("li",[t._v("其次前缀匹配 "),s("code",[t._v("^~")])]),t._v(" "),s("li",[t._v("其次是按文件中顺序的正则匹配")]),t._v(" "),s("li",[t._v("然后匹配不带任何修饰的前缀匹配。")]),t._v(" "),s("li",[t._v("最后是交给 "),s("code",[t._v("/")]),t._v(" 通用匹配")]),t._v(" "),s("li",[t._v("当有匹配成功时候，停止匹配，按当前匹配规则处理请求")])]),t._v(" "),s("blockquote",[s("p",[t._v("注意：前缀匹配，如果有包含关系时，按"),s("strong",[t._v("最大匹配原则")]),t._v("进行匹配。比如在前缀匹配："),s("code",[t._v("location /dir01")]),t._v(" 与 "),s("code",[t._v("location /dir01/dir02")]),t._v("，如有请求 "),s("code",[t._v("http://localhost/dir01/dir02/file")]),t._v(" 将最终匹配到 "),s("code",[t._v("location /dir01/dir02")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);