<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mr.Jiang-技术博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?2675818a983a3131404cee835018f016";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script>
    <meta name="description" content="学习&amp;工作-技术积累">
    
    <link rel="preload" href="/markdown/assets/css/0.styles.5474aed4.css" as="style"><link rel="preload" href="/markdown/assets/js/app.085aa012.js" as="script"><link rel="preload" href="/markdown/assets/js/2.773263cd.js" as="script"><link rel="preload" href="/markdown/assets/js/33.5a2693b9.js" as="script"><link rel="prefetch" href="/markdown/assets/js/1.50bc9635.js"><link rel="prefetch" href="/markdown/assets/js/10.121e7e8f.js"><link rel="prefetch" href="/markdown/assets/js/11.5205ffab.js"><link rel="prefetch" href="/markdown/assets/js/12.fef29d74.js"><link rel="prefetch" href="/markdown/assets/js/13.b581db50.js"><link rel="prefetch" href="/markdown/assets/js/14.07202c28.js"><link rel="prefetch" href="/markdown/assets/js/15.9aedb95a.js"><link rel="prefetch" href="/markdown/assets/js/16.dd97e264.js"><link rel="prefetch" href="/markdown/assets/js/17.8eb943fb.js"><link rel="prefetch" href="/markdown/assets/js/18.942cde78.js"><link rel="prefetch" href="/markdown/assets/js/19.44710683.js"><link rel="prefetch" href="/markdown/assets/js/20.22d46747.js"><link rel="prefetch" href="/markdown/assets/js/21.aa8b4011.js"><link rel="prefetch" href="/markdown/assets/js/22.b40024cc.js"><link rel="prefetch" href="/markdown/assets/js/23.ace5d346.js"><link rel="prefetch" href="/markdown/assets/js/24.2405d60a.js"><link rel="prefetch" href="/markdown/assets/js/25.c08a85e2.js"><link rel="prefetch" href="/markdown/assets/js/26.c4c5f267.js"><link rel="prefetch" href="/markdown/assets/js/27.b91e5849.js"><link rel="prefetch" href="/markdown/assets/js/28.b80c3633.js"><link rel="prefetch" href="/markdown/assets/js/29.594ec447.js"><link rel="prefetch" href="/markdown/assets/js/3.9d4223ad.js"><link rel="prefetch" href="/markdown/assets/js/30.324e278d.js"><link rel="prefetch" href="/markdown/assets/js/31.43dc2191.js"><link rel="prefetch" href="/markdown/assets/js/32.3fb01abd.js"><link rel="prefetch" href="/markdown/assets/js/34.637d4661.js"><link rel="prefetch" href="/markdown/assets/js/35.eccfebaa.js"><link rel="prefetch" href="/markdown/assets/js/36.c13df5f5.js"><link rel="prefetch" href="/markdown/assets/js/37.9890e89c.js"><link rel="prefetch" href="/markdown/assets/js/38.b33827f2.js"><link rel="prefetch" href="/markdown/assets/js/39.3a1ace37.js"><link rel="prefetch" href="/markdown/assets/js/4.27d6f5b1.js"><link rel="prefetch" href="/markdown/assets/js/40.4396d4c2.js"><link rel="prefetch" href="/markdown/assets/js/41.afe775e0.js"><link rel="prefetch" href="/markdown/assets/js/42.19b2951c.js"><link rel="prefetch" href="/markdown/assets/js/43.7c3256ea.js"><link rel="prefetch" href="/markdown/assets/js/44.7da308e4.js"><link rel="prefetch" href="/markdown/assets/js/45.89b2fd21.js"><link rel="prefetch" href="/markdown/assets/js/46.e817e45d.js"><link rel="prefetch" href="/markdown/assets/js/47.c56ee626.js"><link rel="prefetch" href="/markdown/assets/js/48.59541039.js"><link rel="prefetch" href="/markdown/assets/js/49.bc7ad96a.js"><link rel="prefetch" href="/markdown/assets/js/5.2637f2cc.js"><link rel="prefetch" href="/markdown/assets/js/50.9d0dc446.js"><link rel="prefetch" href="/markdown/assets/js/51.4d949834.js"><link rel="prefetch" href="/markdown/assets/js/52.90aa4f80.js"><link rel="prefetch" href="/markdown/assets/js/53.67b77129.js"><link rel="prefetch" href="/markdown/assets/js/54.3535db37.js"><link rel="prefetch" href="/markdown/assets/js/55.9efbe9e5.js"><link rel="prefetch" href="/markdown/assets/js/56.e8aa37ba.js"><link rel="prefetch" href="/markdown/assets/js/57.af66ff8f.js"><link rel="prefetch" href="/markdown/assets/js/58.0415674f.js"><link rel="prefetch" href="/markdown/assets/js/59.b09373ca.js"><link rel="prefetch" href="/markdown/assets/js/6.61bacfb8.js"><link rel="prefetch" href="/markdown/assets/js/60.d07cb515.js"><link rel="prefetch" href="/markdown/assets/js/61.ec2b2da7.js"><link rel="prefetch" href="/markdown/assets/js/62.44a5a0b8.js"><link rel="prefetch" href="/markdown/assets/js/63.09e39adc.js"><link rel="prefetch" href="/markdown/assets/js/64.b9ee085d.js"><link rel="prefetch" href="/markdown/assets/js/65.026450b0.js"><link rel="prefetch" href="/markdown/assets/js/66.a3571972.js"><link rel="prefetch" href="/markdown/assets/js/67.5a8616c4.js"><link rel="prefetch" href="/markdown/assets/js/68.6fdda787.js"><link rel="prefetch" href="/markdown/assets/js/69.691ff5d7.js"><link rel="prefetch" href="/markdown/assets/js/7.32a4bd87.js"><link rel="prefetch" href="/markdown/assets/js/70.b401009e.js"><link rel="prefetch" href="/markdown/assets/js/71.6b3bcefe.js"><link rel="prefetch" href="/markdown/assets/js/72.dcd8145e.js"><link rel="prefetch" href="/markdown/assets/js/73.cc81c046.js"><link rel="prefetch" href="/markdown/assets/js/74.856f40f0.js"><link rel="prefetch" href="/markdown/assets/js/75.746590de.js"><link rel="prefetch" href="/markdown/assets/js/76.8ddba5b5.js"><link rel="prefetch" href="/markdown/assets/js/77.16644476.js"><link rel="prefetch" href="/markdown/assets/js/78.e89fc885.js"><link rel="prefetch" href="/markdown/assets/js/79.1193b665.js"><link rel="prefetch" href="/markdown/assets/js/80.9475cd89.js"><link rel="prefetch" href="/markdown/assets/js/81.8d99d275.js"><link rel="prefetch" href="/markdown/assets/js/82.80eb3e2f.js"><link rel="prefetch" href="/markdown/assets/js/83.fe14141e.js"><link rel="prefetch" href="/markdown/assets/js/84.9647a2db.js"><link rel="prefetch" href="/markdown/assets/js/85.c7258f01.js"><link rel="prefetch" href="/markdown/assets/js/86.1a5782f4.js"><link rel="prefetch" href="/markdown/assets/js/87.e7354607.js"><link rel="prefetch" href="/markdown/assets/js/vendors~docsearch.54f2532f.js">
    <link rel="stylesheet" href="/markdown/assets/css/0.styles.5474aed4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown/" class="home-link router-link-active"><img src="/markdown/logo.png" alt="Mr.Jiang-技术博客" class="logo"> <span class="site-name can-hide">Mr.Jiang-技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/markdown/vben/#🔐-vue3" class="sidebar-link">🔐 vue3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/vben/#api" class="sidebar-link">api</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#injectionkey" class="sidebar-link" style="padding-left:3rem;">InjectionKey</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#unwrapref" class="sidebar-link" style="padding-left:3rem;">UnwrapRef</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#unref" class="sidebar-link" style="padding-left:3rem;">unref</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#torefs" class="sidebar-link" style="padding-left:3rem;">toRefs</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#hooks" class="sidebar-link">hooks</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#usemessage" class="sidebar-link" style="padding-left:3rem;">useMessage</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#useeventlistener" class="sidebar-link" style="padding-left:3rem;">useEventListener</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#useformitem" class="sidebar-link" style="padding-left:3rem;">useFormItem</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#usecountdown" class="sidebar-link" style="padding-left:3rem;">useCountDown</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#vue-router" class="sidebar-link">vue-router</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#vue-i18n" class="sidebar-link">vue-i18n</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#pinia" class="sidebar-link">pinia</a></li></ul></li><li><a href="/markdown/vben/#🔐-components" class="sidebar-link">🔐 components</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/vben/#dropdown" class="sidebar-link">dropDown</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#countdown" class="sidebar-link">countdown</a></li></ul></li><li><a href="/markdown/vben/#🔐-vite" class="sidebar-link">🔐 vite</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/vben/#plugin" class="sidebar-link">plugin</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#glob" class="sidebar-link">glob</a></li></ul></li><li><a href="/markdown/vben/#🔐-lint" class="sidebar-link">🔐 lint</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/vben/#eslint" class="sidebar-link">eslint</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#husky" class="sidebar-link">husky</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#lint-staged" class="sidebar-link">lint-staged</a></li><li class="sidebar-sub-header"><a href="/markdown/vben/#commitlint" class="sidebar-link">commitlint</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content"><div class="content-wrapper" style="width:100%"><div class="theme-default-content custom-content content__default"><blockquote><p>vben-admin 开源项目学习，以下主要记录里面涉及到的知识点</p></blockquote> <h2 id="🔐-vue3"><a href="#🔐-vue3" class="header-anchor">#</a> 🔐 vue3</h2> <h3 id="api"><a href="#api" class="header-anchor">#</a> api</h3> <blockquote><p>vue3 里面暴露出去的 api</p></blockquote> <h4 id="injectionkey"><a href="#injectionkey" class="header-anchor">#</a> InjectionKey</h4> <p>为 <code>provide / inject</code> 标注类型。 Vue 提供了一个 <code>InjectionKey</code> 接口，它是一个继承自 <code>Symbol</code> 的泛型类型，可以用来在提供者和消费者之间同步注入值的类型 <a href="https://cn.vuejs.org/guide/typescript/composition-api.html#typing-provide-inject" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> provide<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> InjectionKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> InjectionKey<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token function">provide</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 若提供的是非字符串值会导致错误</span>

<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo 的类型：string | undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="unwrapref"><a href="#unwrapref" class="header-anchor">#</a> UnwrapRef</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">UnwrapRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Ref<span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

UnwrapRef<span class="token operator">&lt;</span>Ref<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span> <span class="token comment">// number</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="unref"><a href="#unref" class="header-anchor">#</a> unref</h4> <p>如果参数是 <code>ref</code>，则返回内部值；否则返回参数本身，等价于以下判断</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>val <span class="token operator">=</span> <span class="token function">isRef</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">?</span> val<span class="token punctuation">.</span>value <span class="token operator">:</span> val<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="torefs"><a href="#torefs" class="header-anchor">#</a> toRefs</h4> <p>将响应式对象（<code>reactive</code>）转换为普通对象，普通对象的每个属性都是值向原对象的 <code>ref</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;jzy&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// name.value === obj.name</span>
<span class="token comment">// age.value === obj.age</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="hooks"><a href="#hooks" class="header-anchor">#</a> hooks</h3> <blockquote><p>里面比较有意思 hooks 函数</p></blockquote> <h4 id="usemessage"><a href="#usemessage" class="header-anchor">#</a> useMessage</h4> <p><code>useMessage</code> 主要是配置封装<code>antd</code> 消息组件以便在全局引入使用</p> <ul><li><code>notifycation</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  NotificationArgsProps<span class="token punctuation">,</span>
  ConfigProps<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ant-design-vue/lib/notification&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Notifycation 组件提供的方法列表</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">NotifyApi</span> <span class="token punctuation">{</span>
  <span class="token function">info</span><span class="token punctuation">(</span>config<span class="token operator">:</span> NotificationArgsProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">success</span><span class="token punctuation">(</span>config<span class="token operator">:</span> NotificationArgsProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">error</span><span class="token punctuation">(</span>config<span class="token operator">:</span> NotificationArgsProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">warn</span><span class="token punctuation">(</span>config<span class="token operator">:</span> NotificationArgsProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">warning</span><span class="token punctuation">(</span>config<span class="token operator">:</span> NotificationArgsProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">open</span><span class="token punctuation">(</span>args<span class="token operator">:</span> NotificationArgsProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span>key<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">config</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ConfigProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 全局配置 notifycation 选项</span>
notification<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  placement<span class="token operator">:</span> <span class="token string">&quot;topRight&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 出现位置</span>
  duration<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 持续时间</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li><p><code>model</code> ：配置较多，主要需要区分 <code>图标</code>、<code>弹出类型</code></p> <ul><li><p>定义 <code>model</code> 调用方法传入的参数类型</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ModalOptionsEx</span> <span class="token keyword">extends</span> <span class="token class-name">Omit<span class="token operator">&lt;</span>ModalFuncProps<span class="token punctuation">,</span> <span class="token string">&quot;iconType&quot;</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  iconType<span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;success&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;error&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ModalOptionsPartial</span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>ModalOptionsEx<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>定义 <code>model</code> 组件 <code>icon</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  InfoCircleFilled<span class="token punctuation">,</span>
  CheckCircleFilled<span class="token punctuation">,</span>
  CloseCircleFilled<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ant-design/icons-vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getIcon</span><span class="token punctuation">(</span>iconType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>iconType <span class="token operator">===</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>InfoCircleFilled <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal-icon-warning&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>iconType <span class="token operator">===</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>CheckCircleFilled <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal-icon-success&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>iconType <span class="token operator">===</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>InfoCircleFilled <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal-icon-info&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>CloseCircleFilled <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal-icon-error&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>定义 <code>model</code> 内容渲染函数（需要区分是 <code>组件类型</code> 还是<code>普通文本</code> ）</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">renderContent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> content <span class="token punctuation">}</span><span class="token operator">:</span> Pick<span class="token operator">&lt;</span>ModalOptionsEx<span class="token punctuation">,</span> <span class="token string">&quot;content&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div innerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>content <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> content<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>定义 <code>model</code> 基础配置，如 <code>确认按钮文字</code> 、<code>是否垂直居中</code>，同时提供一个 <code>options</code> 创建函数，合并 <code>baseOptions</code> 以及外部传入的参数</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token function-variable function">getBaseOptions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useI18n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    okText<span class="token operator">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">&quot;common.okText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 确认按钮文字</span>
    centered<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 垂直剧中展示 Modal</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 初始化配置</span>
<span class="token keyword">function</span> <span class="token function">createModalOptions</span><span class="token punctuation">(</span>
  options<span class="token operator">:</span> ModalOptionsPartial<span class="token punctuation">,</span>
  icon<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> ModalOptionsPartial <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">getBaseOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>options<span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token function">renderContent</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
    icon<span class="token operator">:</span> <span class="token function">getIcon</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p>有了配置信息，就是去创建对应的实例方法以便直接导出使用</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">createConfirm</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ModalOptionsEx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> iconType <span class="token operator">=</span> options<span class="token punctuation">.</span>iconType <span class="token operator">||</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">;</span>
  Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&quot;iconType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> opt<span class="token operator">:</span> ModalFuncProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    centered<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    icon<span class="token operator">:</span> <span class="token function">getIcon</span><span class="token punctuation">(</span>iconType<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>options<span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token function">renderContent</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Modal<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createSuccessModal</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ModalOptionsPartial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Modal<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token function">createModalOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createErrorModal</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ModalOptionsPartial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Modal<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token function">createModalOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createInfoModal</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ModalOptionsPartial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Modal<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token function">createModalOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createWarningModal</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ModalOptionsPartial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Modal<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token function">createModalOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li></ul></li></ul> <h4 id="useeventlistener"><a href="#useeventlistener" class="header-anchor">#</a> useEventListener</h4> <blockquote><p>addEventListener、removeEventListener 应用</p></blockquote> <p>常用的就是在 <code>window</code> 窗口发生变化的时候更新 <code>info</code>从而在页面根据这些信息进行自适应</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">UseEventParams</span> <span class="token punctuation">{</span>
  el<span class="token operator">:</span> Element <span class="token operator">|</span> Window <span class="token operator">|</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// 需要监听事件触发的DOM对象</span>
  listener<span class="token operator">:</span> EventListener<span class="token punctuation">;</span> <span class="token comment">// 事件触发回调函数</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 监听事件名</span>
  isDebounce<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 是否启动防抖,</span>
  wait<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 防抖时间</span>
  autoRemove<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 是否在DOM变化后自动清除上一个周期绑定的事件监听函数</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>伪代码</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">useEventListener</span><span class="token punctuation">(</span>options<span class="token operator">:</span> UseEventParmas<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function-variable function">removeFn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// remove函数初始化</span>
    <span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    flag <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// flag 标识el是否已经对name进行监听</span>
    <span class="token keyword">if</span> el<span class="token operator">:</span>
        <span class="token comment">// 事件防抖</span>
        isDebounce <span class="token operator">?</span> <span class="token function">useDebounce</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> wait<span class="token punctuation">)</span> <span class="token operator">?</span> listener
    	<span class="token comment">// 绑定事件监听</span>
    	<span class="token function">watch</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> _ov<span class="token punctuation">,</span> cleanup<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// watch 立即执行</span>
          存在 v<span class="token operator">:</span>
           flag <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> addEventListener
          <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              removeEventListener
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="useformitem"><a href="#useformitem" class="header-anchor">#</a> useFormItem</h4> <blockquote><p>表单数据绑定</p></blockquote> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- 父组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FormItem</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sms<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>enter-x<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CountdownInput</span>
          <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>large<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fix-auto-fill<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">v-model:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formData.sms<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>t('sys.login.smsCode')<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FormItem</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 自组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-input</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prefixCls<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>size<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>state<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>以上场景非常常见，即在 <code>FormItem</code> 内嵌套一个自定义组件，通过 <code>v-model</code>进行数据绑定。</p> <p>常见的语法也是通过 <code>props</code> &amp; <code>emits</code> 绑定 <code>value</code> 和 <code>update:value</code> 来实现。</p> <p>而项目中给了一种比较 <strong>新奇</strong> 的方式：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useRuleFormItem</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Recordable<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  props<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span> <span class="token operator">=</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span>
  changeEvent <span class="token operator">=</span> <span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span>
  emitData<span class="token operator">?</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> emit <span class="token operator">=</span> instance<span class="token operator">?.</span>emit<span class="token punctuation">;</span>

  <span class="token keyword">const</span> innerState <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    value<span class="token operator">:</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    innerState<span class="token punctuation">.</span>value <span class="token operator">=</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> state<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> innerState<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEqual</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> defaultState<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

      innerState<span class="token punctuation">.</span>value <span class="token operator">=</span> value <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 保证 ant design 表单的 change 事件能够触发用于规则校验</span>
        emit<span class="token operator">?.</span><span class="token punctuation">(</span>changeEvent<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span><span class="token function">toRaw</span><span class="token punctuation">(</span><span class="token function">unref</span><span class="token punctuation">(</span>emitData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>凡是通过 <code>v-model:value</code> 绑定的值，在自组件中使用如下代码均可完成双向绑定</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-input</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>state<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-input</span><span class="token punctuation">&gt;</span></span>

const [state] = useRuleFormItem(props)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>🔐 理解这个过程</p> <img src="/markdown/assets/img/image-20230718172452126.874816e0.png" style="display:block;margin:auto;"> <p>可以在自组件内部打印下 <code>attrs</code>，出现以上结果；但实际上属性明显从父组件继承下去只有 <code>placeholder</code> 和 <code>class</code>，那多余的像 <code>onBlur</code>、<code>onChange</code>、<code>onUpdate:value</code> 的出现就得深究。</p> <ul><li><code>onBlur</code>、<code>onChange</code>、<code>id</code> 都是<code>FormItem</code>附加在 <code>firstChild</code> 上的，表单校验时需在子项变化后执行校验函数，因此需要拓展子项 <code>onChange</code> 方法来执行 <code>onFieldsChange</code></li></ul> <img src="/markdown/assets/img/image-20230718173137215.e0d91714.png" alt="image-20230718173137215" style="zoom:80%;"> <ul><li><code>onUpdate:value</code> 方法则是 <code>v-model</code> 编译后的余项。因此要实现双向绑定，就要触发 <code>onUpdate:value</code> 来更新数据</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">onUpdate</span><span class="token operator">:</span> <span class="token function-variable function">value</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>formData<span class="token punctuation">.</span>sms <span class="token operator">=</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面代码的思路其实就是跳过这个过程。<strong><code>props</code> 本身在子组件是 <code>readOnly</code>，但实际上也是在更新的</strong>，<code>innerState</code>是对于 <code>props</code> 的引用 而现在将 <code>state</code> 定义为 是 <code>innerState</code> 的 <code>computed</code> 属性， <code>formData.sms = state</code> === <code>formData.sms = innerState.value</code>，<code>innerState</code> 的更新导致了组件的重渲染，<strong>重新读取模板数据</strong>触发 <code>state</code> 的 <code>get</code>方法。</p> <h4 id="usecountdown"><a href="#usecountdown" class="header-anchor">#</a> useCountDown</h4> <p>一个用于倒计时的 <code>hooks</code></p> <ul><li><code>currentCount</code>：保留给外部的倒计时当前值</li> <li><code>methods</code>：<code>start</code>、<code>reset</code>、<code>stop</code>、<code>clear</code> 对于倒计时本身的操作方法</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useCountdown</span><span class="token punctuation">(</span>count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentCount <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> isStart <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> timerId<span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> setInterval<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    timerId <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>timerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isStart<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    timerId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">unref</span><span class="token punctuation">(</span>isStart<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>timerId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    isStart<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    timerId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 濒临结束</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">unref</span><span class="token punctuation">(</span>currentCount<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        currentCount<span class="token punctuation">.</span>value <span class="token operator">=</span> count<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        currentCount<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentCount<span class="token punctuation">.</span>value <span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// vueuse-core</span>
  <span class="token function">tryOnUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> reset<span class="token punctuation">,</span> restart<span class="token punctuation">,</span> clear<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> currentCount<span class="token punctuation">,</span> isStart <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h3 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> vue-router</h3> <blockquote><p>初始化实例</p></blockquote> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  history<span class="token operator">:</span> <span class="token function">createWebHashHistory</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> basicRoutes<span class="token punctuation">,</span>
  strict<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 禁用尾部 /</span>
  <span class="token function-variable function">scrollBehavior</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> top<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p><code>history</code> ：采用 <code>hash</code> 还是 <code>history</code></p></li> <li><p><code>strict</code>：通常来说，<code>/user</code> 可以匹配浏览器输入 <code>/user</code>、<code>/user/</code>，<code>strict</code> 配置为 <code>true</code> 则只允许第一种情况即没有尾部 <code>/</code> 的情况匹配成功</p></li> <li><p><code>scrollBehavior</code>：路由切换完成滚动条的位置</p></li></ul> <h3 id="vue-i18n"><a href="#vue-i18n" class="header-anchor">#</a> vue-i18n</h3> <blockquote><p>实现网站国际化 —— 多语种切换</p></blockquote> <p>🔑 整体文件目录</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>locales
├─helper.ts # utils（包括 setHtmlPageLang 、setLocalePool、genMessage）
├─setupI18n.ts # 初始化实例
├─useLocale.ts # 提供获取/更新当前语言环境的函数
├─lang # 资源包
|  ├─en.ts
|  ├─zh_CN.ts
|  ├─zh-CN
|  |   ├─common.ts
|  |   ├─component.ts
|  |   ├─layout.ts
|  |   ├─sys.ts
|  |   ├─routes
|  |   |   ├─basic.ts
|  |   |   ├─dashboard.ts
|  |   |   └demo.ts
|  ├─en
|  | ├─common.ts
|  | ├─component.ts
|  | ├─layout.ts
|  | ├─sys.ts
|  | ├─routes
|  | |   ├─basic.ts
|  | |   ├─dashboard.ts
|  | |   └demo.ts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>对于 <code>i18n</code> 整个流程，其实可以分为：</p> <ul><li>自定义语种资源包</li> <li>将资源包整合为一个 <code>object</code></li> <li><code>i18n</code> 实例创建，包括资源和配置初始化</li> <li>提供获取和更新 <code>locale</code> 的 hooks <code>useLocale</code></li> <li>提供在 <code>模板</code> 和 <code>ts</code> 文件中使用的 <code>t函数</code> hooks <code>useI18n</code></li></ul> <ol><li>安装依赖</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ pmpm <span class="token function">install</span> vue-i18n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>定义获取资源包代码 —— 该步骤主要根据资源整合生成语种<code>资源映射</code>。具体在 <code>zh_CN.ts</code> 内部，基于 <code>vite</code> 提供的模块导入机制，通过 <code>genMessage</code> 将各个模块整合成对象，整个 <code>export default</code> 出去的就是语言环境为中文的情况下的资源信息</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> genMessage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../helper&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> antdLocale <span class="token keyword">from</span> <span class="token string">&quot;ant-design-vue/es/locale/zh_CN&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> momentLocale <span class="token keyword">from</span> <span class="token string">&quot;moment/dist/locale/zh-cn&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> modules<span class="token operator">:</span> Recordable <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">&quot;./zh-CN/**/*.ts&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  eager<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">genMessage</span><span class="token punctuation">(</span>modules<span class="token punctuation">,</span> <span class="token string">&quot;zh-CN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    antdLocale<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  momentLocale<span class="token punctuation">,</span>
  momentLocaleName<span class="token operator">:</span> <span class="token string">&quot;zh-cn&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li><code>utils</code> —— 将资源名称以及对应的值整合成一个对象
<ul><li>提取文件名作为 <code>object key</code></li> <li>区分一级目录和二级目录 <code>routes/sys</code> &amp; <code>common</code></li></ul></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/**
 * @param langs { './zh-CN/common.ts': { default: {} }}
 * @param prefix language name
 * @return { setting: {
 *  login: { loginButton: '登陆' }
 * }, header: {} }
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genMessage</span><span class="token punctuation">(</span>
  langs<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
  prefix <span class="token operator">=</span> <span class="token string">&quot;lang&quot;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj<span class="token operator">:</span> Recordable <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>langs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> langFileModule <span class="token operator">=</span> langs<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">?.</span>default<span class="token punctuation">;</span>
    <span class="token keyword">let</span> filename <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lastIndex <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    filename <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 去除文件后缀</span>
    <span class="token keyword">const</span> keyLists <span class="token operator">=</span> filename<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 基于文件目录是 routes/xxx</span>
    <span class="token keyword">const</span> moduleName <span class="token operator">=</span> keyLists<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>keyLists<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> moduleName<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span><span class="token punctuation">,</span> keyLists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> langFileModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> moduleName<span class="token punctuation">,</span> langFileModule <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ol start="3"><li>提供 <code>i18n</code> 初始化函数
<ol><li>执行资源加载 <code>zh_CN.ts</code></li> <li>自定义 <code>i18n</code> 选项</li> <li>暴露 <code>setupI18n</code> 给 <code>main.ts</code></li></ol></li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createI18nOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>I18nOptions<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> localeStore <span class="token operator">=</span> <span class="token function">useLocaleStoreWithout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 语言环境 store</span>
  <span class="token keyword">const</span> locale <span class="token operator">=</span> localeStore<span class="token punctuation">.</span>getLocale<span class="token punctuation">;</span> <span class="token comment">// 获得当前语言环境</span>
  <span class="token keyword">const</span> defaultLocale <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./lang/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>locale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得加载资源包函数</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> defaultLocale<span class="token punctuation">.</span>default<span class="token operator">?.</span>message <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">setHtmlPageLang</span><span class="token punctuation">(</span>locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 标识资源包已经被加载了</span>
  <span class="token function">setLocalePool</span><span class="token punctuation">(</span><span class="token punctuation">(</span>loadLocalePool<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    loadLocalePool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>locale<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// i18n 配置选项</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    legacy<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 使用 composition api 模式</span>
    locale<span class="token punctuation">,</span>
    fallbackLocale<span class="token operator">:</span> fallback<span class="token punctuation">,</span> <span class="token comment">// 回退语言</span>
    availableLocales<span class="token punctuation">,</span>
    messages<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>locale<span class="token punctuation">]</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    silentTranslationWarn<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 禁止本地化失败警告</span>
    missingWarn<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    silentFallbackWarn<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 仅在根本没有可用的转换时生成警告</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// main.ts 中用于初始化 i18n</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setupI18n</span><span class="token punctuation">(</span>app<span class="token operator">:</span> App<span class="token operator">&lt;</span>Element<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createI18nOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  i18n <span class="token operator">=</span> <span class="token function">createI18n</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token keyword">as</span> I18n<span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>i18n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ol start="4"><li><p>有了初始化函数后初始的资源显示就没有问题了，但是缺少一个用于更新的函数 —— 当语言环境更新的时候需要进行什么操作</p> <ol><li>更新 <code>store locale</code></li> <li>判断当前语言环境情况</li></ol> <img src="/markdown/assets/img/image-20230629105852577.b0d38326.png" alt="image-20230629105852577" style="zoom:67%;"></li> <li><p>最后 <code>i18n</code> 的配置、更新都设置好了，就是如何在<code>模板</code>或者 <code>ts</code> 文件中引入的问题。实际可以抽取成一个 <code>hooks</code></p></li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 类型定义</span>
<span class="token keyword">type</span> <span class="token class-name">I18nGlobalTranslation</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> locale<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> locale<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> list<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> locale<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> named<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> list<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> named<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">I18nGlobalOptions</span> <span class="token keyword">extends</span> <span class="token class-name">Omit<span class="token operator">&lt;</span><span class="token keyword">typeof</span> i18n<span class="token punctuation">.</span>global<span class="token punctuation">,</span> <span class="token string">&quot;t&quot;</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  t<span class="token operator">:</span> I18nGlobalTranslation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name">I18nTranslationRestParameters</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// composition api hooks</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useI18n</span><span class="token punctuation">(</span>namespace<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  t<span class="token operator">:</span> I18nGlobalTranslation<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> normalFn <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">t</span><span class="token operator">:</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// return getKey(namespace, key); namespace 作用暂不明确</span>
      <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>i18n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> normalFn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span> t<span class="token punctuation">,</span> <span class="token operator">...</span>methods <span class="token punctuation">}</span> <span class="token operator">=</span> i18n<span class="token punctuation">.</span>global <span class="token keyword">as</span> I18nGlobalOptions<span class="token punctuation">;</span>

  <span class="token keyword">const</span> tFn<span class="token operator">:</span> <span class="token function-variable function">I18nGlobalTranslation</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>arg<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>key<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>key<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>namespace<span class="token punctuation">)</span> <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token function">getKey</span><span class="token punctuation">(</span>namespace<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>arg <span class="token keyword">as</span> I18nTranslationRestParameters<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>methods<span class="token punctuation">,</span>
    t<span class="token operator">:</span> tFn<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在 setup 函数以外使用</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">t</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>在用的时候就可以</p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ t(&quot;sys.login.loginButton&quot;) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useI18n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>为了在 vscode 中有对应信息提示，得下载一个 <code>i18 ally</code> 插件，并在项目 <code>settings.json</code> 中配置</p></blockquote> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;i18n-ally.localesPaths&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/locales/lang&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 指定资源所在路径</span>
  <span class="token property">&quot;i18n-ally.keystyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nested&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;i18n-ally.sortKeys&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;i18n-ally.namespace&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;i18n-ally.pathMatcher&quot;</span><span class="token operator">:</span> <span class="token string">&quot;{locale}/{namespaces}.{ext}&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;i18n-ally.enabledParsers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ts&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;i18n-ally.sourceLanguage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;i18n-ally.displayLanguage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zh-CN&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;i18n-ally.enabledFrameworks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="pinia"><a href="#pinia" class="header-anchor">#</a> pinia</h3> <blockquote><p>vue 目前流行的状态管理工具</p></blockquote> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> useCounterStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">double</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>state</code>：<code>store</code> 中的数据</li> <li><code>getter</code>：<code>store</code> 中的计算属性</li> <li><code>actions</code>：<code>store</code> 中的 <code>method</code></li></ul> <p>以上是最简 <code>pinia</code> 配置</p> <p>当然除了以上 <code>option configuration</code>，也支持在构造函数内使用 <code>composition api</code> 的方式定义数据、计算属性和方法。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> useCounterStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> increment <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>👿 解构响应式属性 <code>storeToRefs</code></p></blockquote> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>storeToRefs<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useCounterStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// `name` 和</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">doubleCount</span><span class="token template-punctuation string">`</span></span> 是响应式的 ref <span class="token comment">// 会跳过所有的 action 或非响应式 (不是 ref 或</span>
  reactive<span class="token punctuation">)</span> 的属性 <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> doubleCount<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span> <span class="token comment">// 作为</span>
  action 的 increment 可以直接解构 <span class="token keyword">const</span> <span class="token punctuation">{</span>increment<span class="token punctuation">}</span> <span class="token operator">=</span> store
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>👿 使用 store</p></blockquote> <p>如果是在 <code>script setup</code> 内部的话，直接导入并执行函数即可</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>useCounterStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/stores/counter'</span> <span class="token keyword">const</span> store <span class="token operator">=</span>
  <span class="token function">useCounterStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果不能使用组合式 <code>api</code>则需要使用映射辅助函数</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 允许访问 this.counterStore 和 this.userStore</span>
    <span class="token operator">...</span><span class="token function">mapStores</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span> useUserStore<span class="token punctuation">)</span>
    <span class="token comment">// 允许读取 this.count 和 this.double</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'double'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 允许读取 this.increment()</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="🔐-components"><a href="#🔐-components" class="header-anchor">#</a> 🔐 components</h2> <p>项目在 <code>components</code> 内部封装了若干公共组件，包括 <code>Dropdown</code>、<code>Menu</code>……，以下主要从封装思路去描述</p> <h3 id="dropdown"><a href="#dropdown" class="header-anchor">#</a> dropDown</h3> <blockquote><p>下拉框</p></blockquote> <p>从下拉框的基本使用需求来说，需要提供</p> <ul><li>下拉菜单列表数据</li> <li>默认菜单选中选项</li> <li>触发条件(单击、双击、悬浮)</li> <li>触发事件</li></ul> <p>更高级的话可以增加一个是否确认的标识 <code>popConfirm</code> —— 在触发条件后需要用户确认再触发事件；而实际 <code>confirm</code>、<code>cancel</code> 的配置则放入到 <code>dropMenuList</code> 中，因此对 <code>dropMenuList</code> 需要约定类型</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">DropMenu</span> <span class="token punctuation">{</span>
  text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  confirm<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  cancel<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">DropDownOptions</span> <span class="token punctuation">{</span>
  dropMenuList<span class="token operator">:</span> DropMenu<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  selectedKeys<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  trigger<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// click/doubleclick...</span>
  <span class="token function-variable function">menuEvent</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  popConfirm<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="countdown"><a href="#countdown" class="header-anchor">#</a> countdown</h3> <blockquote><p>计数器(获取验证码阶段倒计时)</p></blockquote> <p>从计时器本身来说 <code>CountButton</code>，需要提供</p> <ul><li>倒计时初始值</li> <li>倒计时执行前需要执行的请求函数</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">CountButtonParams</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function-variable function">beforeFn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>同时需要提供 <code>reset</code>、<code>start</code>、<code>restart</code>、<code>stop</code> 等等与计时相关方法</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count <span class="token operator">=</span> defaultValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span>restart<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span>stop<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="🔐-vite"><a href="#🔐-vite" class="header-anchor">#</a> 🔐 vite</h2> <ul><li>初始化 <code>vue-ts</code> 项目</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">pnpm</span> create vite vue-ts-project <span class="token parameter variable">--template</span> vue-ts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>集成 <code>typescript</code> 环境</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">pnpm</span> <span class="token function">add</span> typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint eslint-plugin-vue <span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置 <code>eslintrc</code></p> <h3 id="plugin"><a href="#plugin" class="header-anchor">#</a> plugin</h3> <blockquote><p>插件列表主要是拓展项目功能</p></blockquote> <ul><li><p><code>@vitejs/plugin-vue</code>：支持 <code>vue</code> 项目</p></li> <li><p><code>@vitejs/plugin-vue-jsx</code>：支持 <code>vue</code> 使用 <code>jsx</code> 或者 <code>tsx</code> 语法</p> <p>在开发的时候遇到一个问题，经过了漫长的排错最终才发现是项目并不支持使用 <code>jsx</code> 语法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">SyntaxError</span><span class="token operator">:</span> expected expression<span class="token punctuation">,</span> got <span class="token string">'&lt;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="glob"><a href="#glob" class="header-anchor">#</a> glob</h3> <p><code>glob</code> 在 vite 中用于动态导入，构建时会分离为独立 chunk</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">&quot;./dir/*.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// vite 生成的代码</span>
<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;./dir/foo.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./dir/foo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;./dir/bar.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./dir/bar.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 遍历访问模块</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> path <span class="token keyword">in</span> modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  modules<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="🔐-lint"><a href="#🔐-lint" class="header-anchor">#</a> 🔐 lint</h2> <blockquote><p><code>eslint</code> 、<code>prettier</code>、 <code>husky</code>、<code>lint-staged</code>、<code>commitlint</code></p></blockquote> <h3 id="eslint"><a href="#eslint" class="header-anchor">#</a> eslint</h3> <p><a href="http://www.huhaowb.com/2022/10/11/vite%E5%88%9B%E5%BB%BAVue3%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEESLint/" target="_blank" rel="noopener noreferrer">宝藏配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>： 覆盖了绝大部分的 <code>eslint</code> 、<code>prettier</code> 配置，非常好的一篇文章</p> <ul><li>依赖安装</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">pnpm</span> <span class="token function">install</span> eslint eslint-plugin-vue @typescript-eslint/eslint-plugin @typescript-eslint/parser prettier eslint-config-prettier eslint-plugin-prettier
<span class="token parameter variable">-D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p><code>prettier</code>：prettier 的核心代码</p></li> <li><p><code>eslint-config-prettier</code>：这将禁用 ESLint 中的格式化规则，而 Prettier 将负责处理这些规则</p></li> <li><p><code>eslint-plugin-prettier</code> ：把 Prettier 推荐的格式问题的配置以 ESLint rules 的方式写入，统一代码问题的来源。</p></li> <li><p><code>eslint</code>： ESLint 的核心代码</p></li> <li><p><code>@typescript-eslint/parser</code> ：SLint 的解析器，用于解析 typescript，从而检查和规范 Typescript 代码</p></li> <li><p><code>@typescript/eslint/eslint-plugin</code>：包含了各类定义好的检测 Typescript 代码的规范</p></li> <li><p><code>eslint-plugin-vue</code>：支持对 vue 文件检验 <a href="https://eslint.vuejs.org/rules/max-len.html" target="_blank" rel="noopener noreferrer">规则集<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><code>vue-eslint-parser</code>：这个解析器允许我们检测.vue 文件的 <code>&lt;template&gt;</code>。</p></li> <li><p><code>eslint.js</code></p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// @ts-check</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;eslint-define-config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">es6</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&quot;vue-eslint-parser&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&quot;@typescript-eslint/parser&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">jsxPragma</span><span class="token operator">:</span> <span class="token string">&quot;React&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;plugin:vue/vue3-recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;prettier&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;plugin:prettier/recommended&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;vue/script-setup-uses-vars&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/ban-ts-ignore&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/explicit-function-return-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/no-explicit-any&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/no-var-requires&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/no-empty-function&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/custom-event-name-casing&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-use-before-define&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/no-use-before-define&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/ban-ts-comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/ban-types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/no-non-null-assertion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/explicit-module-boundary-types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;@typescript-eslint/no-unused-vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">argsIgnorePattern</span><span class="token operator">:</span> <span class="token string">&quot;^_&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">varsIgnorePattern</span><span class="token operator">:</span> <span class="token string">&quot;^_&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-unused-vars&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">argsIgnorePattern</span><span class="token operator">:</span> <span class="token string">&quot;^_&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">varsIgnorePattern</span><span class="token operator">:</span> <span class="token string">&quot;^_&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;space-before-function-paren&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>

    <span class="token string-property property">&quot;vue/attributes-order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/v-on-event-hyphenation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/multi-word-component-names&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/one-component-per-file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/html-closing-bracket-newline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/max-attributes-per-line&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/multiline-html-element-content-newline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/singleline-html-element-content-newline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/attribute-hyphenation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/require-default-prop&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 'vue/html-self-closing': [</span>
    <span class="token comment">//   'error',</span>
    <span class="token comment">//   {</span>
    <span class="token comment">//     html: {</span>
    <span class="token comment">//       void: 'always',</span>
    <span class="token comment">//       normal: 'never',</span>
    <span class="token comment">//       component: 'always',</span>
    <span class="token comment">//     },</span>
    <span class="token comment">//     svg: 'always',</span>
    <span class="token comment">//     math: 'always',</span>
    <span class="token comment">//   },</span>
    <span class="token comment">// ],</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><ul><li><code>prettier.config.js</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">// 单行最大长度</span>
  <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//  句尾默认添加分号</span>
  <span class="token literal-property property">vueIndentScriptAndStyle</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 缩进Vue文件中脚本和样式</span>
  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 字符串使用单引号</span>
  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 尾逗号</span>
  <span class="token literal-property property">proseWrap</span><span class="token operator">:</span> <span class="token string">&quot;never&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 对于 markdown 文件来说不强制换行 https://github.com/prettier/prettier/issues/6766</span>
  <span class="token literal-property property">htmlWhitespaceSensitivity</span><span class="token operator">:</span> <span class="token string">&quot;strict&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 换行符跟随像</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p><code>eslint</code>、<code>prettier</code> 主要在工作区阶段对我们编写的代码进行格式限制，但实际并不影响代码执行，一旦 <code>git</code>提交到远程仓库，会混淆仓库内文件格式，导致别人在拉代码后报错（即使不影响执行，但爆红就很不好）。</p></blockquote> <ul><li><code>husky</code>：监听 <code>git</code> 各个钩子周期</li> <li><code>lint-staged</code>：针对暂存区的内容进行代码格式校验</li> <li><code>commitlint</code>：针对 <code>commit msg</code> 进行格式校验</li></ul> <h3 id="husky"><a href="#husky" class="header-anchor">#</a> husky</h3> <ul><li>依赖安装</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> husky
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>配置 <code>npm install</code> 之前执行 <code>husky install</code></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;prepare&quot;</span><span class="token operator">:</span> <span class="token string">&quot;husky install&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="lint-staged"><a href="#lint-staged" class="header-anchor">#</a> lint-staged</h3> <ul><li>依赖安装</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> lint-staged
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>配置文件 <code>lintstagedrc.js</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;*.{js,jsx,ts,tsx}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;prettier --write&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;{!(package)*.json,*.code-snippets,.!(browserslist)*rc}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;prettier --write--parser json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;package.json&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;prettier --write&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;*.vue&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;prettier --write&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;*.md&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;prettier --write&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>配置 <code>script</code> 钩子执行</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lint:lint-staged&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged -c ./.husky/lintstagedrc.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>pre-commit</code> 钩子执行 <code>lint-staged</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ npx husky <span class="token function">add</span> .husky/pre-commit <span class="token string">'npm run lint:lint-staged'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="commitlint"><a href="#commitlint" class="header-anchor">#</a> commitlint</h3> <ul><li>依赖安装</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> @commitlint/cli @commitlint/config-conventional
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>commit-msg</code> 钩子执行 <code>lint-staged</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ npx husky <span class="token function">add</span> .husky/commit-msg <span class="token string">&quot;npx --no -- commitlint --edit <span class="token variable">$1</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit page-editor"><div class="edit-link"><a href="https://github.com/jzyismylover/ubuntu-markdown/edit/docs/source/vben/vben.md" target="_blank" rel="noopener noreferrer">完善页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">3/17/2024, 9:24:20 AM</span></div></footer> <!----></div> <div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:86vh"><div style="font-weight:bold;"></div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/markdown/vben/#🔐-vue3" class="toc-sidebar-link">🔐 vue3</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#api" class="toc-sidebar-link">api</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#injectionkey" class="toc-sidebar-link">InjectionKey</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#unwrapref" class="toc-sidebar-link">UnwrapRef</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#unref" class="toc-sidebar-link">unref</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#torefs" class="toc-sidebar-link">toRefs</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#hooks" class="toc-sidebar-link">hooks</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#usemessage" class="toc-sidebar-link">useMessage</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#useeventlistener" class="toc-sidebar-link">useEventListener</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#useformitem" class="toc-sidebar-link">useFormItem</a></li><li class="toc-sidebar-sub-header toc-sidebar-depth-4"><a href="/markdown/vben/#usecountdown" class="toc-sidebar-link">useCountDown</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#vue-router" class="toc-sidebar-link">vue-router</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#vue-i18n" class="toc-sidebar-link">vue-i18n</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#pinia" class="toc-sidebar-link">pinia</a></li></ul></li><li><a href="/markdown/vben/#🔐-components" class="toc-sidebar-link">🔐 components</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#dropdown" class="toc-sidebar-link">dropDown</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#countdown" class="toc-sidebar-link">countdown</a></li></ul></li><li><a href="/markdown/vben/#🔐-vite" class="toc-sidebar-link">🔐 vite</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#plugin" class="toc-sidebar-link">plugin</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#glob" class="toc-sidebar-link">glob</a></li></ul></li><li><a href="/markdown/vben/#🔐-lint" class="toc-sidebar-link">🔐 lint</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#eslint" class="toc-sidebar-link">eslint</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#husky" class="toc-sidebar-link">husky</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#lint-staged" class="toc-sidebar-link">lint-staged</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/vben/#commitlint" class="toc-sidebar-link">commitlint</a></li></ul></li></ul></div></div></div></div></div>  <div></div></main> <aside class="page-sidebar"> <div class="page-side-toolbar"></div>  </aside></div><div class="global-ui"><!----></div></div>
    <script src="/markdown/assets/js/app.085aa012.js" defer></script><script src="/markdown/assets/js/2.773263cd.js" defer></script><script src="/markdown/assets/js/33.5a2693b9.js" defer></script>
  </body>
</html>
