<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入浅出 nodejs | Mr.Jiang-技术博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?2675818a983a3131404cee835018f016";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script>
    <meta name="description" content="学习&amp;工作-技术积累">
    
    <link rel="preload" href="/markdown/assets/css/0.styles.5474aed4.css" as="style"><link rel="preload" href="/markdown/assets/js/app.085aa012.js" as="script"><link rel="preload" href="/markdown/assets/js/2.773263cd.js" as="script"><link rel="preload" href="/markdown/assets/js/14.07202c28.js" as="script"><link rel="prefetch" href="/markdown/assets/js/1.50bc9635.js"><link rel="prefetch" href="/markdown/assets/js/10.121e7e8f.js"><link rel="prefetch" href="/markdown/assets/js/11.5205ffab.js"><link rel="prefetch" href="/markdown/assets/js/12.fef29d74.js"><link rel="prefetch" href="/markdown/assets/js/13.b581db50.js"><link rel="prefetch" href="/markdown/assets/js/15.9aedb95a.js"><link rel="prefetch" href="/markdown/assets/js/16.dd97e264.js"><link rel="prefetch" href="/markdown/assets/js/17.8eb943fb.js"><link rel="prefetch" href="/markdown/assets/js/18.942cde78.js"><link rel="prefetch" href="/markdown/assets/js/19.44710683.js"><link rel="prefetch" href="/markdown/assets/js/20.22d46747.js"><link rel="prefetch" href="/markdown/assets/js/21.aa8b4011.js"><link rel="prefetch" href="/markdown/assets/js/22.b40024cc.js"><link rel="prefetch" href="/markdown/assets/js/23.ace5d346.js"><link rel="prefetch" href="/markdown/assets/js/24.2405d60a.js"><link rel="prefetch" href="/markdown/assets/js/25.c08a85e2.js"><link rel="prefetch" href="/markdown/assets/js/26.c4c5f267.js"><link rel="prefetch" href="/markdown/assets/js/27.b91e5849.js"><link rel="prefetch" href="/markdown/assets/js/28.b80c3633.js"><link rel="prefetch" href="/markdown/assets/js/29.594ec447.js"><link rel="prefetch" href="/markdown/assets/js/3.9d4223ad.js"><link rel="prefetch" href="/markdown/assets/js/30.324e278d.js"><link rel="prefetch" href="/markdown/assets/js/31.43dc2191.js"><link rel="prefetch" href="/markdown/assets/js/32.3fb01abd.js"><link rel="prefetch" href="/markdown/assets/js/33.5a2693b9.js"><link rel="prefetch" href="/markdown/assets/js/34.637d4661.js"><link rel="prefetch" href="/markdown/assets/js/35.eccfebaa.js"><link rel="prefetch" href="/markdown/assets/js/36.c13df5f5.js"><link rel="prefetch" href="/markdown/assets/js/37.9890e89c.js"><link rel="prefetch" href="/markdown/assets/js/38.b33827f2.js"><link rel="prefetch" href="/markdown/assets/js/39.3a1ace37.js"><link rel="prefetch" href="/markdown/assets/js/4.27d6f5b1.js"><link rel="prefetch" href="/markdown/assets/js/40.4396d4c2.js"><link rel="prefetch" href="/markdown/assets/js/41.afe775e0.js"><link rel="prefetch" href="/markdown/assets/js/42.19b2951c.js"><link rel="prefetch" href="/markdown/assets/js/43.7c3256ea.js"><link rel="prefetch" href="/markdown/assets/js/44.7da308e4.js"><link rel="prefetch" href="/markdown/assets/js/45.89b2fd21.js"><link rel="prefetch" href="/markdown/assets/js/46.e817e45d.js"><link rel="prefetch" href="/markdown/assets/js/47.c56ee626.js"><link rel="prefetch" href="/markdown/assets/js/48.59541039.js"><link rel="prefetch" href="/markdown/assets/js/49.bc7ad96a.js"><link rel="prefetch" href="/markdown/assets/js/5.2637f2cc.js"><link rel="prefetch" href="/markdown/assets/js/50.9d0dc446.js"><link rel="prefetch" href="/markdown/assets/js/51.4d949834.js"><link rel="prefetch" href="/markdown/assets/js/52.90aa4f80.js"><link rel="prefetch" href="/markdown/assets/js/53.67b77129.js"><link rel="prefetch" href="/markdown/assets/js/54.3535db37.js"><link rel="prefetch" href="/markdown/assets/js/55.9efbe9e5.js"><link rel="prefetch" href="/markdown/assets/js/56.e8aa37ba.js"><link rel="prefetch" href="/markdown/assets/js/57.af66ff8f.js"><link rel="prefetch" href="/markdown/assets/js/58.0415674f.js"><link rel="prefetch" href="/markdown/assets/js/59.b09373ca.js"><link rel="prefetch" href="/markdown/assets/js/6.61bacfb8.js"><link rel="prefetch" href="/markdown/assets/js/60.d07cb515.js"><link rel="prefetch" href="/markdown/assets/js/61.ec2b2da7.js"><link rel="prefetch" href="/markdown/assets/js/62.44a5a0b8.js"><link rel="prefetch" href="/markdown/assets/js/63.09e39adc.js"><link rel="prefetch" href="/markdown/assets/js/64.b9ee085d.js"><link rel="prefetch" href="/markdown/assets/js/65.026450b0.js"><link rel="prefetch" href="/markdown/assets/js/66.a3571972.js"><link rel="prefetch" href="/markdown/assets/js/67.5a8616c4.js"><link rel="prefetch" href="/markdown/assets/js/68.6fdda787.js"><link rel="prefetch" href="/markdown/assets/js/69.691ff5d7.js"><link rel="prefetch" href="/markdown/assets/js/7.32a4bd87.js"><link rel="prefetch" href="/markdown/assets/js/70.b401009e.js"><link rel="prefetch" href="/markdown/assets/js/71.6b3bcefe.js"><link rel="prefetch" href="/markdown/assets/js/72.dcd8145e.js"><link rel="prefetch" href="/markdown/assets/js/73.cc81c046.js"><link rel="prefetch" href="/markdown/assets/js/74.856f40f0.js"><link rel="prefetch" href="/markdown/assets/js/75.746590de.js"><link rel="prefetch" href="/markdown/assets/js/76.8ddba5b5.js"><link rel="prefetch" href="/markdown/assets/js/77.16644476.js"><link rel="prefetch" href="/markdown/assets/js/78.e89fc885.js"><link rel="prefetch" href="/markdown/assets/js/79.1193b665.js"><link rel="prefetch" href="/markdown/assets/js/80.9475cd89.js"><link rel="prefetch" href="/markdown/assets/js/81.8d99d275.js"><link rel="prefetch" href="/markdown/assets/js/82.80eb3e2f.js"><link rel="prefetch" href="/markdown/assets/js/83.fe14141e.js"><link rel="prefetch" href="/markdown/assets/js/84.9647a2db.js"><link rel="prefetch" href="/markdown/assets/js/85.c7258f01.js"><link rel="prefetch" href="/markdown/assets/js/86.1a5782f4.js"><link rel="prefetch" href="/markdown/assets/js/87.e7354607.js"><link rel="prefetch" href="/markdown/assets/js/vendors~docsearch.54f2532f.js">
    <link rel="stylesheet" href="/markdown/assets/css/0.styles.5474aed4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown/" class="home-link router-link-active"><img src="/markdown/logo.png" alt="Mr.Jiang-技术博客" class="logo"> <span class="site-name can-hide">Mr.Jiang-技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/jzyismylover/ubuntu-markdown" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入浅出 nodejs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/markdown/deep-nodejs/#第一章" class="sidebar-link">第一章</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第二章-模块机制" class="sidebar-link">第二章 模块机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/deep-nodejs/#核心模块" class="sidebar-link">核心模块</a></li></ul></li><li><a href="/markdown/deep-nodejs/#第三章-异步-i-o" class="sidebar-link">第三章 异步 I/O</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第四章-异步编程" class="sidebar-link">第四章 异步编程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第五章-内存管理" class="sidebar-link">第五章 内存管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown/deep-nodejs/#新生代内存回收算法" class="sidebar-link">新生代内存回收算法</a></li><li class="sidebar-sub-header"><a href="/markdown/deep-nodejs/#老生代内存回收算法" class="sidebar-link">老生代内存回收算法</a></li></ul></li><li><a href="/markdown/deep-nodejs/#第六章-buffer" class="sidebar-link">第六章 Buffer</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第七章-网络编程" class="sidebar-link">第七章 网络编程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第八章-构建-web-应用" class="sidebar-link">第八章 构建 web 应用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第九章-玩转进程" class="sidebar-link">第九章 玩转进程</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content"><div class="content-wrapper" style="width:100%"><div class="theme-default-content custom-content content__default"><h1 id="深入浅出-nodejs"><a href="#深入浅出-nodejs" class="header-anchor">#</a> 深入浅出 nodejs</h1> <h2 id="第一章"><a href="#第一章" class="header-anchor">#</a> 第一章</h2> <p>关键词：回调函数、异步 IO、事件循环、并行 IO、单线程、master worker、web worker、child_process、CPU 密集</p> <h2 id="第二章-模块机制"><a href="#第二章-模块机制" class="header-anchor">#</a> 第二章 模块机制</h2> <p>关键词：模块化、Commonjs、核心模块、文件模块、自定义模块、模块路径、文件定位、包缓存、作用域隔离、runThisContext、</p> <h3 id="核心模块"><a href="#核心模块" class="header-anchor">#</a> 核心模块</h3> <p>关键词：Module._extensions、libuv、c++扩展插件</p> <blockquote><p>小节阅读抽象，主要描述了核心模块的一些内容，核心模块有分为 C++编写和 JS 编写，其中使用 C++ 编写的又称为内建模块 <a href="https://www.imyangyong.com/blog/2019/07/node/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20Node%20%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97/" target="_blank" rel="noopener noreferrer">blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <ul><li><p>npm 通过镜像下载包</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> <span class="token function">install</span> underscore <span class="token parameter variable">--registry</span><span class="token operator">=</span>http://registry.url
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>npm 设置镜像源</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry http://registry.url
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>npm 包需要多人管理</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> owner <span class="token function">ls</span> <span class="token operator">&lt;</span>package name<span class="token operator">&gt;</span> <span class="token comment"># 查看package所有者信息</span>
<span class="token function">npm</span> owner <span class="token function">add</span> <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>package name<span class="token operator">&gt;</span> <span class="token comment"># 添加一个所有者</span>
<span class="token function">npm</span> owner <span class="token function">rm</span> <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>package name<span class="token operator">&gt;</span> <span class="token comment"># 删除一个所有者</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h2 id="第三章-异步-i-o"><a href="#第三章-异步-i-o" class="header-anchor">#</a> 第三章 异步 I/O</h2> <ul><li><p>为什么异步 IO 在 JS 中很重要</p> <p>因为在浏览器中 Javascript 在单线程中上执行，且与 UI 渲染共用一个线程，如果没有异步机制的话那么实际阻塞带来的延时严重影响用户体验。</p></li> <li><p>阻塞/非阻塞 &amp; 同步/异步 两大概念的区别</p> <p>阻塞/非阻塞其实是一个操作系统内核级别的概念，在进行 I/O 操作的时候如果 CPU 需要等待 I/O 任务完成后才处理下一个任务，那么这种行为就是阻塞的。而对于同步和异步而言则更多归属与事件循环里面去解释。</p></li> <li><p>跨平台异步 IO 架构</p></li></ul> <img src="/markdown/assets/img/image-20230920005407581.e8cd504d.png" style="display:block;margin:auto;"> <ul><li>fs.open 执行过程</li></ul> <img src="/markdown/assets/img/image-20230920010704604.b8195f9f.png" style="display:block;margin:auto;"> <p>调用封装逻辑：Javascript 调用 Node 核心模块，核心模块调用 C++ 内建模块，内建模块通过 libuv 进行系统调用。libuv 作为封装层，有两个平台的实现，实质是调用了 us_fs_open 方法</p> <img src="/markdown/assets/img/image-20230923181630972.05f4517a.png" style="display:block;margin:auto;"> <ol><li>node 通过 JS 调用核心函数通过层层封装实际调用了系统底层函数，随后封装请求对象进入线程池中等待执行</li> <li>线程空闲，执行请求对象中 I/O 操作，执行完成通过 <code>PostQueuedCompletionStatus</code> 方法通知 IOCP（<code>IOCP全称I/O Completion Port，中文译为I/O完成端口。IOCP是一个异步I/O的Windows API</code>），将当前线程归还给线程池</li> <li>I/O 观察者在执行每一个 tick 的时候会执行 <code>GetQueuedCompletionStatus</code> 方法检查线程池中是否有执行完的请求，如果存在，会将请求对象加入到 I/O 观察者的队列中</li></ol> <p>⭐️ 事件循环、观察者、请求对象、I/O 线程池四者共同构成了 Node 异步 I/O 模型的基本要素</p> <ul><li><p>setTimeout、process.nextTick、setImmediate</p> <ul><li>setTimtOut：执行时会创建定时器对象并插入到观察者对象的一个红黑树中，每次 Tick 执行的时候会从红黑树中迭代取出定时器对象，检查是否超出定时事件。缺点：红黑树查找的复杂度是 O(lgn)，且时间并非精确（每一个 tick 受任务时间阻塞长度影响）</li> <li>process.nextTick，setImmediate：两者类似，都是通过将回调函数放入队列中，在下一轮 tick 时取出执行。
<ul><li>区别一：由于每一个 tick 其实观察者的检查是有先后顺序，process.nextTick 属于 idle 观察者，setImmediate 属性属于 check 观察者，idle 优先于 check，因此在同一个 tick 中 process.nextTick 执行顺序优于 setImmediate。</li> <li>区别二：process.nextTick 回调其实是存储在一个数组中，而 setImmediate 存储在一个链表中，因此每次 tick process.nextTick 都会取出数组中的所有回调并执行，而 setImmediate 则执行链表中的每一项</li></ul></li></ul></li> <li><p>经典的服务器模型</p> <ul><li>同步式</li> <li>每进程/每请求</li> <li>每线程/每请求</li></ul></li></ul> <h2 id="第四章-异步编程"><a href="#第四章-异步编程" class="header-anchor">#</a> 第四章 异步编程</h2> <ul><li>异步编程难点
<ul><li>异常处理：因为逻辑函数在下一个 tick 才执行，因此当前 tick 的事件捕获其实并不能正常捕获错误，因此通常都是在回调函数的第一个参数暴露标识是否发生错误</li> <li>函数嵌套过深：很多时候逻辑函数之间有一个执行先后顺序要求，那么就会出现一个回调函数里面嵌套另外一个逻辑函数，如果这样的依赖很多，那么就会不断嵌套导致层级太深</li> <li>阻塞代码：node 没有 sleep 函数，而使用 setTimeout 并不能阻止后续代码执行，因此通常使用一个 while 循环来完成 sleep，但这实际会占用 CPU，与其他编程语言的线程休眠大相径庭</li> <li>多线程编程：现在对于多核 CPU 利用率要求提高，需要 node 支持</li> <li>异步转同步：node 部分异步 API 没有提供同步使用方法</li></ul></li></ul> <blockquote><p>异步编程主要的解决方案有 三种：事件发布/订阅模式、Promise/Defferred 模式、流程控制库模式</p></blockquote> <p><strong>事件发布/订阅模式</strong></p> <ul><li><p>事件队列解决雪崩问题</p> <p>雪崩问题：在高访问量、大并发量的情况下缓存失效的情景，大量的请求同时涌入数据库中，数据库无法同时承受如此大的查询请求，从而影响到网站整体的响应速度</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> status <span class="token operator">=</span> <span class="token string">&quot;ready&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">select</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  proxy<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;selected&quot;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token string">&quot;ready&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    status <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;SQL&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      proxy<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;selected&quot;</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
      status <span class="token operator">=</span> <span class="token string">&quot;ready&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p><code>eventproxy</code></p> <p>nodejs 并发控制第三方包，更优雅解决并行任务执行</p> <ul><li>使用哨兵解决并行任务执行完成后再执行主逻辑</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://data1_source&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span>data1 <span class="token operator">=</span> data<span class="token punctuation">;</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://data2_source&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span>data2 <span class="token operator">=</span> data<span class="token punctuation">;</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://data3_source&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span>data3 <span class="token operator">=</span> data<span class="token punctuation">;</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token function">fuck</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data1<span class="token punctuation">,</span> result<span class="token punctuation">.</span>data2<span class="token punctuation">,</span> result<span class="token punctuation">.</span>data3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">render</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li>使用 <code>eventproxy</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> ep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">eventproxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ep<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
  <span class="token string">&quot;data1_event&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data2_event&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data3_event&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data1<span class="token punctuation">,</span> data2<span class="token punctuation">,</span> data3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token function">fuck</span><span class="token punctuation">(</span>data1<span class="token punctuation">,</span> data2<span class="token punctuation">,</span> data3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

$<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://data1_source&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ep<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;data1_event&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

$<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://data2_source&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ep<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;data2_event&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

$<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://data3_source&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ep<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;data3_event&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>eq.all</code> 函数会等待所有监听事件都完成后才触发回调函数执行，且回调函数参数的顺序与事件监听的顺序一致。<code>eventproxy</code> 另一个优势在与简单的错误处理。如果是基于事件发布/订阅模式实现上述流程的话，还需要额外抛出以及监听错误事件执行对应回调，而 <code>eventproxy</code> 提供了两个 API</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> ep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">eventproxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ep<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
ep<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token string">&quot;event&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>ep<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// means</span>
<span class="token function">ep</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ep<span class="token punctuation">.</span><span class="token function">unbuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 卸载调所有处理函数</span>
  <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步回调</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>ep<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">)</span>
<span class="token comment">// means</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> ep<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    ep<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>通过两个封装的 API 简化了整个错误处理流程</p></li></ul> <p><strong>Promise/Deferred 模式</strong></p> <ul><li><p>deffered 主要用于内部，用户维护异步模型的状态；promise 则作用于外部，通过 then 方法暴露给外部添加自定义逻辑</p> <img src="/markdown/assets/img/image-20230924153431969.25702437.png" style="display:block;margin:auto;"></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">Promise</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isPromise <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 支持 then 链式调用</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
  <span class="token parameter">fulfilledHandler<span class="token punctuation">,</span>
  errorHandler<span class="token punctuation">,</span>
  progressHandler</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fulfilledHandler <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">.</span>fulfilled <span class="token operator">=</span> fulfilledHandler<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> errorHandler <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">.</span>error <span class="token operator">=</span> errorHandler<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">Deferred</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Deferred</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
  <span class="token keyword">var</span> handler<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>handler <span class="token operator">=</span> promise<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ret <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">fulfilled</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&amp;&amp;</span> ret<span class="token punctuation">.</span>isPromise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ret<span class="token punctuation">.</span>queue <span class="token operator">=</span> promise<span class="token punctuation">.</span>queue<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>promise <span class="token operator">=</span> ret<span class="token punctuation">;</span> <span class="token comment">// 更新链式调用 promise 引用</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 回调</span>
<span class="token class-name">Deferred</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> that<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    that<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p><strong>流程控制库</strong></p> <p>和 Promise/Deferred 不一样的是，流程控制库不强调维护状态，而是通过不同回调函数注入位置来实现异步编程，可以理解为用户只需要关注回调函数的执行顺序即可，不需要关心内部逻辑处理。常用的流程控制库有 <code>async</code>、<code>step</code> ……</p> <p><strong>异步并发控制</strong></p> <blockquote><p>异步编程让我们能够并发任务，但是一旦并发的数量超过某个阈值，可能会导致过系统资源过度使用而报错</p></blockquote> <p>解决思路：</p> <ul><li>通过一个队列来控制并发量</li> <li>如果当前活跃（调用发起但未执行回调）的异步调用量小于限定值，从队列中取出执行</li> <li>如果活跃调用达到限定值，调用暂时存放在队列中</li> <li>每个异步调用结束时，从队列中取出新的异步调用执行</li></ul> <h2 id="第五章-内存管理"><a href="#第五章-内存管理" class="header-anchor">#</a> 第五章 内存管理</h2> <img src="/markdown/assets/img/image-20230924165018279.9518ed01.png" style="display:block;margin:auto;"> <blockquote><p>内存管理主要是堆内存管理</p></blockquote> <h3 id="新生代内存回收算法"><a href="#新生代内存回收算法" class="header-anchor">#</a> 新生代内存回收算法</h3> <p><strong>cherry 算法</strong></p> <p><code>cherry</code> 算法时一种采用复制的方式实现的垃圾回收算法，通过将堆内存一分为二，每一部分空间成为 <code>semispace</code>。在两个 <code>semispace</code> 中，只有一个处于使用中，另一个处于闲置状态。处于使用状态的称为 <code>from</code> 空间，处于限制状态的空间成为 <code>to</code> 空间。当开始分配对象时，先在 <code>from</code> 空间中进行分配，当开始进行垃圾回收时，会检查 from 空间中的存活对象，这些存活对象会被复制到 to 空间中，而非存活对象占用的空间将会被释放，完成复制后，from 空间和 to 空间的角色发生对换，典型地使用空间换取时间的回收算法。</p> <img src="/markdown/assets/img/image-20230924165921956.c09aa704.png" style="display:block;margin:auto;"> <blockquote><p>其实从 from 空间复制到 to 空间的过程中还会经历一个“筛选”过程，需要将存活周期长的对象转移到老生代，这种行为叫 “对象晋升”</p></blockquote> <img src="/markdown/assets/img/image-20230924171509674.cf3946d6.png" style="display:block;margin:auto;"> <img src="/markdown/assets/img/image-20230924171520728.e6406c36.png" style="display:block;margin:auto;"> <p>以上两图时对象晋升的条件，满足一条就可以晋升到老生代内存区中</p> <h3 id="老生代内存回收算法"><a href="#老生代内存回收算法" class="header-anchor">#</a> 老生代内存回收算法</h3> <blockquote><p>采用 <code>Mark-Sweep</code> 和 <code>Mark-Compact</code> 相结合的方式</p></blockquote> <img src="/markdown/assets/img/image-20230924171819970.74e55ae8.png" style="display:block;margin:auto;"> <p><code>mark-sweep</code> （标记清除）最大的问题是在进行一次标记清除回收后，内存空间会出现不连续状态，这种内存碎片会对后续的内存分配造成问题 —— 在分配大对象的时和，碎片空间无法分配，提前触发垃圾回收，而这次回收是不必要的。</p> <img src="/markdown/assets/img/image-20230924172219550.92badea5.png" style="display:block;margin:auto;"> <p><code>mark-compact</code> （标记整理），在 <code>mark-sweep</code> 的基础上，将存活的对象往一端移动，移动完成后直接清理掉边界外的内存，这样就能够保证内存的连续性</p> <ul><li>性能比较</li></ul> <img src="/markdown/assets/img/image-20230924172416609.050e1523.png" style="display:block;margin:auto;"> <p>考虑 <code>mark-compact</code> 需要移动对象速度较慢，因此 V8 在老生代区域主要使用 <code>mark-sweep</code> ，只有当剩余空间不足以分配给从新生代晋升的对象时才会使用 <code>mark-compact</code></p> <ul><li><p>全停顿</p> <p>为了避免出现 javascript 应用逻辑与垃圾回收器看到不一致的情况，上述三种基本算法都需要将应用逻辑暂停下来，等待执行完成垃圾回收后再恢复执行应用逻辑，这种行为被成为“全停顿”，也叫“全堆回收垃圾”</p></li></ul> <img src="/markdown/assets/img/image-20230924172714387.ed8d5b3e.png" style="display:block;margin:auto;"> <p>为了解决全堆回收垃圾带来的停顿时间（主要是老生代区域标记遍历的时间），引出“增量标记”，即将过程拆分为若干步，JS 执行逻辑与垃圾回收交替进行指导标记阶段完成</p> <h2 id="第六章-buffer"><a href="#第六章-buffer" class="header-anchor">#</a> 第六章 Buffer</h2> <p>Buffer 创建、内存分配</p> <ul><li>什么是 Buffer：Buffer 可以理解为是一个元素为 16 进制两位数的数组</li> <li>如何进行内存分配：对于大小比较小的 buffer 对象，采用 slab 分配方式，每个 slab 大小为 8KB，分配空间不足则创建下一个 slab。对于比较大的 buffer 对象，直接采用 C++ 层面的 <code>SlowBuffer</code></li></ul> <p>Buffer 与 Str 类型转换</p> <ul><li><p>目前 Buffer 支持转换的字符串编码类型有：ASCII、UTF-8、UTF-16LE/UCS-2、Base64、Binary、Hex，调用方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">[</span>encoding<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不传默认是 utf-8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Windows 125 系 、ISO-8859 系 、IBM/DOS、Macintosh 系 、KOI8 系 ，Latin1、US-ASCII， GBK GB2312，像这些不支持的编码可以使用 <code>iconv</code> 进行转换</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> iconv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Iconv</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ASCII//TRANSLIT//IGNORE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最多三层降级</span>
iconv<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">&quot;ça va&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;ca va &quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <p>Buffer 乱码问题</p> <ul><li><p>为什么会存在乱码？宽字节的中文会在分批次读取中被截断导致部分内容无法正常解析</p></li> <li><p>如何解决？<code>string_decoder</code> ：在设置可读流的时候可以设置编码类型，<code>string_decoder</code> 在不改变读取次数的情况下，能够不分割宽字节，将当前被截断的部分字节拼接到下一部分。</p></li> <li><p>如何解决？（高级）正确拼接 <code>buffer</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  size <span class="token operator">+=</span> chunk<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>chunks<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> str <span class="token operator">=</span> iconv<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Buffer<span class="token punctuation">.</span><span class="token function-variable function">concat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: Buffer.concat(list, [length])&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> length <span class="token operator">!==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> buf <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      length <span class="token operator">+=</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> buf <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 复制 buffer</span>
    buf<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pos <span class="token operator">+=</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> buffer<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div></li></ul> <h2 id="第七章-网络编程"><a href="#第七章-网络编程" class="header-anchor">#</a> 第七章 网络编程</h2> <p>章节主要描述了 node 内建模块如何建立一些常用的网络连接，像 TCP、UDP、WebSocket。</p> <ul><li>创建 TCP 服务器</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token comment">// step03</span>
    	socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// step05</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// step02</span>
	socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>创建 TCP 连接</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;net&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// step01</span>
  client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// step04</span>
  client<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>创建 UDP 连接</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dgram&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">&quot;udp4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;listening&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bind 绑定后触发</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接收到数据推送</span>
<span class="token function">server</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>http 请求模块</p></blockquote> <p>为什么会引出这样一个模块？很多时候我们并不关注协议本身的实现，需要一个顶层设计帮我们解决实际问题，<code>http</code> 模块可以帮我们快速建立 <code>tcp</code> 长连接。并且封装了请求对象、响应对象，让我们能够通过 <code>JS</code> 对象操作数据报文（<code>buffer</code> 二进制数据）</p> <blockquote><p>http.globalAgent</p></blockquote> <p>可以理解为是 <code>JS HTTP</code> 连接池，控制并发发送请求的数量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> agent <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">Agent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">/* 可传入 http 中自定义连接池 */</span> <span class="token literal-property property">maxSockets</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="第八章-构建-web-应用"><a href="#第八章-构建-web-应用" class="header-anchor">#</a> 第八章 构建 web 应用</h2> <p>章节主要描述了 node 如何构建一个后端服务，总的来说可以分为：</p> <ul><li>请求方法&amp;路径解析：解析路径并得到其中的一些路由参数（url package）</li> <li>身份鉴权
<ul><li>cookie、session</li> <li>jwt</li></ul></li> <li>中间件处理
<ul><li>数据预处理</li> <li>db 连接</li></ul></li> <li>数据响应
<ul><li>向客户端响应不同的数据格式（content-type）</li> <li>附件下载（content-disposition)</li></ul></li> <li>模板渲染
<ul><li>模板渲染的原理（regexap）</li> <li>模板转义防止 xss （escape）</li></ul></li></ul> <h2 id="第九章-玩转进程"><a href="#第九章-玩转进程" class="header-anchor">#</a> 第九章 玩转进程</h2> <p>node 在 v8 中运行是单进程+单线程结构，为了充分利用 cpu ，可以复制出与系统 cpu 核心数相同的子进程。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child_process<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token string">&quot;./worker.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>spawn：启动一个子进程执行命令</li> <li>exec：启动一个子进程执行命令，区别于 spawn，有一个回调函数可以获取子进程的状况</li> <li>execFile：启动一个子进程执行可执行文件</li> <li>fork：与 spawn 类似，不同在于创建的子进程只需执行指定需要执行的 javascript 文件</li></ul> <img src="/markdown/assets/img/image-20231125113556664.3a115404.png" style="display:block;margin:auto;"> <p>子进程与父进程之间通过 ipc 进行数据通信，地层基于 libuv 的实现</p></div> <footer class="page-edit page-editor"><div class="edit-link"><a href="https://github.com/jzyismylover/ubuntu-markdown/edit/docs/reading/deep-nodejs.md" target="_blank" rel="noopener noreferrer">完善页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">3/17/2024, 9:24:20 AM</span></div></footer> <!----></div> <div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:86vh"><div style="font-weight:bold;">深入浅出 nodejs</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/markdown/deep-nodejs/#第一章" class="toc-sidebar-link">第一章</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第二章-模块机制" class="toc-sidebar-link">第二章 模块机制</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/deep-nodejs/#核心模块" class="toc-sidebar-link">核心模块</a></li></ul></li><li><a href="/markdown/deep-nodejs/#第三章-异步-i-o" class="toc-sidebar-link">第三章 异步 I/O</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第四章-异步编程" class="toc-sidebar-link">第四章 异步编程</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第五章-内存管理" class="toc-sidebar-link">第五章 内存管理</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/markdown/deep-nodejs/#新生代内存回收算法" class="toc-sidebar-link">新生代内存回收算法</a></li><li class="toc-sidebar-sub-header"><a href="/markdown/deep-nodejs/#老生代内存回收算法" class="toc-sidebar-link">老生代内存回收算法</a></li></ul></li><li><a href="/markdown/deep-nodejs/#第六章-buffer" class="toc-sidebar-link">第六章 Buffer</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第七章-网络编程" class="toc-sidebar-link">第七章 网络编程</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第八章-构建-web-应用" class="toc-sidebar-link">第八章 构建 web 应用</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/markdown/deep-nodejs/#第九章-玩转进程" class="toc-sidebar-link">第九章 玩转进程</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div>  <div></div></main> <aside class="page-sidebar"> <div class="page-side-toolbar"></div>  </aside></div><div class="global-ui"><!----></div></div>
    <script src="/markdown/assets/js/app.085aa012.js" defer></script><script src="/markdown/assets/js/2.773263cd.js" defer></script><script src="/markdown/assets/js/14.07202c28.js" defer></script>
  </body>
</html>
